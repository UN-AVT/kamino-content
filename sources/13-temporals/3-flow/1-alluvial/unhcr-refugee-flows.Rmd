---
pagetitle: "Kamino"
output: 
  html_document:
    theme: lumen
    css: ["../../../z-assemblers/kamino.css", "../../../z-assemblers/temporals.css"]
    df_print: paged
    mathjax: NULL
    code_folding: show
    include:
      in_header: "../../../z-assemblers/header.html"
      after_body: "../../../z-assemblers/footer.html"
    #self_contained: false
    #lib_dir: libs
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(message=FALSE, warning=FALSE, echo = FALSE)
options(scipen=999)  # turn-off scientific notation like 1e+48

library(reshape2)
library(tidyverse)
library(stringr)
library(ggplot2)
library(ggalluvial)
library(gridExtra)
library(wesanderson)

library(htmltools) # needed to include html snippets
library(knitcitations)
library(bibtex)

```

<div class="activity">
TEMPORALS
</div>

# Alluvial Plot
## Energy Consumption by Country & Fuel Type

<p>Alluvial diagrams are a type of <strong>flow diagram</strong> originally developed to represent changes in network structure over time. In allusion to both their visual appearance and their emphasis on flow, alluvial diagrams are named after alluvial fans that are naturally formed by the soil deposited from streaming water.</p>

<a href="https://github.com/owid/energy-data">Data Source: Our World in Data</a>

```{r, echo=FALSE}

df = read.csv("../archetypes/unhcr-refugee-flows.csv", header = TRUE, stringsAsFactors = FALSE)  # read text file 
df <- df %>% filter(Year == 2020)  

df_top_10 <- df %>% arrange(Refugees_under_UNHCRs_mandate) %>% tail(10)
df_top_10

origin_countries <- c("Eritrea")
df_country <- df %>% filter(Country_of_origin %in% origin_countries)

# Top 10 of country
df_country <- df_country %>% arrange(Refugees_under_UNHCRs_mandate) %>% tail(10)
df_country

# Standard theme options to use for each view
theme_opts <- theme(
  legend.position = "none",
  legend.title = element_blank(),
  # axis.text = element_blank(),
  # axis.line = element_blank(),
  # axis.ticks = element_blank(),
  # axis.title = element_blank(),
  # panel.grid = element_blank(),
  # panel.grid.major = element_blank(),
  panel.grid.minor = element_blank(),
  panel.background=element_rect(fill="white", colour="white"),
  panel.border = element_blank(),
  plot.background = element_blank()
)

```

# Section
## Subsection

```{r, echo=FALSE, fig.width=11, fig.height=6}

pal <- wes_palette("Zissou1", 10, type = "continuous")

# View using alluvium geom
v1 <- ggplot(data = df_country, aes(axis1 = Origin_ISO, axis2 = Asylum_ISO, y = Refugees_under_UNHCRs_mandate)) +
  geom_alluvium(aes(fill = Refugees_under_UNHCRs_mandate), width = 1/16, size=1.5, colour = "#ffffff", alpha = 1.0) +
  geom_stratum(width = 1/16, fill = "white", color = "black") +
  geom_text(stat = "stratum", aes(label = after_stat(stratum)), size = 2) +
  scale_x_discrete(limits = c("Eritrea", "Destinations"), expand = c(.05, .05)) +
  scale_fill_gradientn(colours = pal) + 
  # in case any marks fall outside panel
  coord_cartesian(clip = "off") +
  # a simple theme to modify
  theme_minimal() +
  # rotate years
  # theme(axis.text.x = element_text(angle = -90, hjust = 1, vjust = 0.5)) +
  # use configured theme options
  theme_opts +
  labs(
    x="",
    y="",
    title="Top 10 Receiving Refugee Flows for Eritrea",
    subtitle="Refugees_under_UNHCRs_mandate"
  )

v1

```

# Section
## Subsection

```{r, echo=FALSE, fig.width=11, fig.height=7.5}

v2 <- ggplot(data = df_top_10, aes(axis1 = Origin_ISO, axis2 = Asylum_ISO, y = Refugees_under_UNHCRs_mandate)) +
  geom_alluvium(aes(fill = Refugees_under_UNHCRs_mandate), width = 1/16, size=1.5, colour = "#ffffff", alpha = 1.0) +
  geom_stratum(width = 1/16, fill = "white", color = "black") +
  geom_text(stat = "stratum", aes(label = after_stat(stratum)), size = 2) +
  scale_x_discrete(limits = c("Origins", "Destinations"), expand = c(.05, .05)) +
  scale_fill_gradientn(colours = pal) + 
  # in case any marks fall outside panel
  coord_cartesian(clip = "off") +
  # a simple theme to modify
  theme_minimal() +
  # rotate years
  # theme(axis.text.x = element_text(angle = -90, hjust = 1, vjust = 0.5)) +
  # use configured theme options
  theme_opts +
  labs(
    x="",
    y="",
    title="Top 10 Receiving Refugee Flows",
    subtitle="Refugees_under_UNHCRs_mandate"
  )

v2

```

# Section
## Subsection

```{r, echo=FALSE}

# Save plot to svg file
# ggsave(filename = "alluvial-unhcr-refugee-flows-v1.svg", plot = v1, width=12, height=6)
# ggsave(filename = "alluvial-unhcr-refugee-flows-v2.svg", plot = v2, width=12, height=6)

```


# Exercises and practice
## Knime and R practice solutions



# References
## The citations and data sources used for this case



```{r generateBibliography, echo=FALSE, eval=TRUE, message=FALSE, warning=FALSE}

# cleanbib()
# read.bibtex(file = "./citations.bib")

```


```{r, message=FALSE, warning=FALSE, echo=FALSE}

# echo=FALSE will exclude block from code folding
# Example for including external html content when needed
htmltools::includeHTML("mark-complete-button.html")

```



```{r, child='mark-complete-click.Rmd'}

# JS event handler for button click

```



```{js, message=FALSE, warning=FALSE, echo=FALSE}

// Must be included to position footer
$(function() {
  $('.main-container').after($('.footer'));
})

```


