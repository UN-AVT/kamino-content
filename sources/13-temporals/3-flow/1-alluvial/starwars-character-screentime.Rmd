---
pagetitle: "Kamino"
output: 
  html_document:
    theme: lumen
    css: ["../../../z-assemblers/kamino.css", "../../../z-assemblers/temporals.css"]
    df_print: paged
    mathjax: NULL
    code_folding: show
    include:
      in_header: "../../../z-assemblers/header.html"
      after_body: "../../../z-assemblers/footer.html"
    #self_contained: false
    #lib_dir: libs
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(message=FALSE, warning=FALSE, echo = FALSE)
options(scipen=999)  # turn-off scientific notation like 1e+48

library(reshape2)
library(tidyverse)
library(stringr)
library(ggplot2)
library(ggalluvial)
library(gridExtra)

library(htmltools) # needed to include html snippets
library(knitcitations)
library(bibtex)

```

<div class="activity">
TEMPORALS
</div>

# Alluvial Plot
## Star Wars Saga Character Screentime

<p>Alluvial diagrams are a type of <strong>flow diagram</strong> originally developed to represent changes in network structure over time. In allusion to both their visual appearance and their emphasis on flow, alluvial diagrams are named after alluvial fans that are naturally formed by the soil deposited from streaming water.</p>

<a href="https://www.imdb.com/list/ls027631145/">Data Source: IMDB</a>

```{r, echo=FALSE}

df = read.csv("../archetypes/starwars-character-screentime-long.csv", header = TRUE, stringsAsFactors = FALSE)  # read text file 
df

# Standard theme options to use for each view
theme_opts <- theme(
  legend.position = "bottom",
  legend.title = element_blank(),
  # axis.text = element_blank(),
  # axis.line = element_blank(),
  # axis.ticks = element_blank(),
  # axis.title = element_blank(),
  # panel.grid = element_blank(),
  # panel.grid.major = element_blank(),
  panel.grid.minor = element_blank(),
  panel.background=element_rect(fill="white", colour="white"),
  panel.border = element_blank(),
  plot.background = element_blank()
)

```

# Section
## Subsection

```{r, echo=FALSE, fig.width=11, fig.height=6}

episode_list <- c("I_The_Phantom_Menace", 
                  "II_Attack_of_the_Clones", 
                  "III_Revenge_of_the_Sith",
                  "IV_A_New_Hope",
                  "V_The_Empire_Strikes_Back",
                  "VI_Return_of_the_Jedi",
                  "VII_The_Force_Awakens",
                  "VIII_The_Last_Jedi",
                  "IX_The_Rise_of_Skywalker")

character_palette <- c("Yoda" = "#749c54", 
                  "Rey" = "#BAB0AC", 
                  "R2-D2" = "#4E79A7",
                  "Poe Dameron" = "#A0CBE8",
                  "Padme Amidala" = "#D37295",
                  "Obi-Wan Kenobi" = "#79706E",
                  "Luke Skywalker" = "#8CD17D",
                  "Leia Organa" = "#86BCB6",
                  "Han Solo" = "#b7b7b7",
                  "Finn" = "orange",
                  "Emperor Palpatine / Darth Sidious" = "#FF9D9A",
                  "Chewbacca" = "#9D7660",
                  "C-3PO" = "#F1CE63",
                  "Ben Solo / Kylo Ren" = "#D11D29",
                  "Anakin Skywalker / Darth Vader" = "#E15759")

v1 <- ggplot(data = df, aes(x = EPISODE, y = SCREENTIME, alluvium = CHARACTER, stratum = EPISODE)) +
  geom_alluvium(aes(fill = CHARACTER), width = 1/8, size=1.0, colour = "#ffffff", alpha = 1.0, decreasing = FALSE) +
  geom_stratum(width = 1/8, fill = "white", color = "black") +
  geom_text(stat = "stratum", aes(label = after_stat(stratum)), size = 2, angle = -90, hjust = 0.5, vjust = 0.1 ) +
  # for set episode
  scale_x_discrete(labels = c("I", "II", "III", "IV", "V", "VI", "VII", "VIII", "IX"), limits = episode_list, expand = c(.05, .05)) +
  # use the palette defined above
  scale_fill_manual(values = character_palette) +
  # in case any marks fall outside panel
  coord_cartesian(clip = "off") +
  # a simple theme to modify
  theme_minimal() +
  # use configured theme options
  theme_opts +
  labs(
    x="",
    y="",
    title="Star Wars Saga",
    subtitle="Character Screentime Top 15"
  )

v1


```

# Section
## Subsection

```{r, echo=FALSE, fig.width=11, fig.height=6}

v2 <- ggplot(data = df, aes(x = EPISODE, y = SCREENTIME, alluvium = CHARACTER, stratum = EPISODE)) +
  geom_alluvium(aes(fill = CHARACTER), width = 1/4, size=1.0, colour = "#ffffff", alpha = 1.0, decreasing = FALSE) +
  geom_stratum(width = 1/4, fill = "white", color = "black") +
  geom_text(stat = "stratum", aes(label = after_stat(stratum)), size = 2, hjust = 0.5, vjust = 0.3 ) +
  # for set episode
  scale_x_discrete(labels = rev(c("I", "II", "III", "IV", "V", "VI", "VII", "VIII", "IX")), limits = rev(episode_list), expand = c(.05, .05)) +
  # use the palette defined above
  scale_fill_manual(values = character_palette) +
  # in case any marks fall outside panel
  coord_cartesian(clip = "off") +
  coord_flip(clip = "off") +
  # a simple theme to modify
  theme_minimal() +
  # use configured theme options
  theme_opts +
  theme(legend.position = "right") +
  labs(
    x="",
    y="",
    title="Star Wars Saga",
    subtitle="Character Screentime Top 15"
  )

v2

```

# Section
## Subsection

```{r, echo=FALSE}

# Save plot to svg file
# ggsave(filename = "alluvial-star-wars-v1.svg", plot = v1, width=11, height=6)
# ggsave(filename = "alluvial-star-wars-v2.svg", plot = v2, width=11, height=6)

```


# Exercises and practice
## Knime and R practice solutions



# References
## The citations and data sources used for this case



```{r generateBibliography, echo=FALSE, eval=TRUE, message=FALSE, warning=FALSE}

# cleanbib()
# read.bibtex(file = "./citations.bib")

```


```{r, message=FALSE, warning=FALSE, echo=FALSE}

# echo=FALSE will exclude block from code folding
# Example for including external html content when needed
htmltools::includeHTML("mark-complete-button.html")

```



```{r, child='mark-complete-click.Rmd'}

# JS event handler for button click

```



```{js, message=FALSE, warning=FALSE, echo=FALSE}

// Must be included to position footer
$(function() {
  $('.main-container').after($('.footer'));
})

```


