---
pagetitle: "Kamino"
output: 
  html_document:
    theme: lumen
    css: ["../../../z-assemblers/assets/styles/content/kamino.css", "../../../z-assemblers/assets/icons/line-awesome/css/line-awesome.css"]
    df_print: paged
    mathjax: NULL
    code_folding: show
    include:
      in_header: "../../../z-assemblers/fragments/header.html"
      after_body: "../../../z-assemblers/fragments/footer.html"
    #self_contained: false
    #lib_dir: libs
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(message=FALSE, warning=FALSE, echo = FALSE)
options(scipen = 999) ## To disable scientific notation

# Clear environment and memory
rm(list = ls(all.names = TRUE)) #will clear all objects includes hidden objects.
gc() #free up memrory and report the memory usage.

library(dplyr)
library(magrittr)
library(ggplot2)
library(ggalt)
require(ggrepel)
library(scales)
library(wesanderson)
library(ggiraph)

library(showtext)
# Font used for views
font_add_google(name = "Open Sans", family = "Open Sans")
showtext_auto()

library(htmltools) # needed to include html snippets
library(knitcitations)
library(bibtex)

```

<div class="activity">
TEMPORALS
</div>

# Rank Chart a.k.a. Bump
## Times Higher Education World University Ranking

> A University should be a place of light, of liberty, and of learning...\
--- Benjamin Disraeli\

<p>A Rank or Bump Chart is a special form of a line plot designed for exploring changes in rank over time. The focus here is usually on comparing the position or performance of multiple observations with respect to each other rather than the actual values itself, hence the rank measure can be a composite of other values.</p>

***

## Load data [Ingest]

```{r, message=FALSE, warning=FALSE, echo=TRUE, class.source = 'fold-hide'}

rank_df = read.csv("archetypes/times-higher-education-world-university-ranking.csv", header = TRUE, stringsAsFactors = TRUE)  # read text file 
rank_df

```


## Prepare data [Wrangle]


```{r, message=FALSE, warning=FALSE, echo=TRUE, class.source = 'fold-hide'}

# Filter for year and continent
rank_df <- rank_df %>%
  filter(world_rank <= 20 )
# Create ordered factor for year
rank_df$year <- factor(rank_df$year, ordered = TRUE, levels = c("2012", "2013", "2014", "2015"))
rank_df

```


## Plot [ Views / Temporals ]


```{r, message=FALSE, warning=FALSE, echo=TRUE, class.source = 'fold-hide', fig.width=12, fig.height=8, fig.align='center', out.width="100%"}

plot_specs <- list(  
  # move the x axis labels up top
  scale_x_discrete(position = "top"),
  theme_bw(),
  theme( plot.margin = unit(c(0,3,0,3), "cm") ),
  # Format tweaks
  # Remove the legend
  theme(legend.position = "none"),
  # Remove the panel border
  theme(panel.border     = element_blank()),
  # Remove just about everything from the y axis
  theme(axis.title.y     = element_blank()),
  theme(axis.text.y      = element_blank()),
  theme(panel.grid.major.y = element_blank()),
  theme(panel.grid.minor.y = element_blank()),
  # Remove a few things from the x axis and increase font size
  theme(axis.title.x     = element_blank()),
  theme(panel.grid.major.x = element_blank()),
  theme(axis.text.x.top      = element_text(size=12)),
  # Remove x & y tick marks
  theme(axis.ticks       = element_blank()),
  # Format title & subtitle
  theme(plot.title       = element_text(size=14, face = "bold")),
  theme(plot.subtitle    = element_text())
)

rank_plot = ggplot(data = rank_df, aes(x = year, y = world_rank, group = institution)) +
  geom_line(aes(color = country), size = 0.5, alpha = 1) +
  geom_text(data = rank_df %>% filter(year == "2012"), 
                  aes(label = paste0(institution)) , 
                  hjust = "right",
                  nudge_x = -0.05,
                  nudge_y = 0.05, 
                  fontface = "bold", 
                  size = 2.5) +
  geom_text(data = rank_df %>% filter(year == "2015"), 
                  aes(label = paste0(institution)), 
                  hjust = "left",
                  nudge_x = 0.05,
                  nudge_y = 0.05, 
                  fontface = "bold", 
                  size = 2.5) +
  geom_point(shape = 21, color = "white", fill="white", size = 4.0, stroke = 1, alpha = 1) +
  geom_text(aes(label = world_rank), 
                  color="black", 
                  alpha = 1,
                  size = 2.0,
                  nudge_y = 0.05) +
  scale_y_reverse() +
  # Important to remove clipping for long y axis labels
  coord_cartesian(clip = "off") +
  scale_fill_manual(values = wes_palette("FantasticFox1")) +
  scale_color_manual(values = wes_palette("FantasticFox1")) +
  plot_specs +
  labs(
    title = "World University Ranking",
    subtitle = "Top 20, 2012-2015",
    caption = "source: Times Higher Education"
  )

# rank_plot

girafe(ggobj = rank_plot, width_svg = 13.0, height_svg = 13.0,
       options = list(opts_sizing(rescale = TRUE, width = 1)))

```



```{r, message=FALSE, warning=FALSE, echo=TRUE, class.source = 'fold-hide'}

# ggsave(filename = "times-higher-education-world-university-ranking.svg", plot = rank_plot, width=13.33, height=7.5)

```


# Exercises and practice
## Knime and R practice solutions



# References
## The citations and data sources used for this case

<a href="https://www.timeshighereducation.com/world-university-rankings">Rankings</a>

```{r generateBibliography, echo=FALSE, eval=TRUE, message=FALSE, warning=FALSE}

# cleanbib()
# read.bibtex(file = "./citations.bib")

```




```{js, message=FALSE, warning=FALSE, echo=FALSE}

// Must be included to position footer
$(function() {
  $('.main-container').after($('.footer'));
})

showtext_auto(FALSE) 

```



