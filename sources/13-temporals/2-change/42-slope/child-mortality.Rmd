---
pagetitle: "Kamino"
output: 
  html_document:
    theme: lumen
    css: ["../../../z-assemblers/assets/styles/content/kamino.css", "../../../z-assemblers/assets/icons/line-awesome/css/line-awesome.css"]
    df_print: paged
    mathjax: NULL
    code_folding: show
    include:
      in_header: "../../../z-assemblers/fragments/header.html"
      after_body: "../../../z-assemblers/fragments/footer.html"
    self_contained: false
    lib_dir: libs
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(message=FALSE, warning=FALSE, echo = FALSE)
options(scipen = 999) ## To disable scientific notation

# Clear environment and memory
rm(list = ls(all.names = TRUE)) #will clear all objects includes hidden objects.
gc() #free up memrory and report the memory usage.

library(dplyr)
library(magrittr)
library(ggplot2)
require(ggrepel)
library(ggiraph)
library(CGPfunctions)
library(scales)
library(plotrix)

library(knitcitations)
library(bibtex)

```

<div class="activity">
TEMPORALS
</div>

# Slope Plot
## Child Mortality

<p>Defined by Edward Tufte in his 1983 book The Visual Display of Quantitative Information, this type of chart is useful for seeing trends over time and comparison among the subjects (categorical) measured.</p>


***

## Load data [Ingest]

```{r, message=FALSE, warning=FALSE, echo=TRUE, class.source = 'fold-hide'}

# Load csv data file
child_mortality_df = read.csv("archetypes/child-mortality-1990-vs-2017-slope.csv", header = TRUE, stringsAsFactors = FALSE)
child_mortality_df

```


## Prepare data [Wrangle]


```{r, message=FALSE, warning=FALSE, echo=TRUE, class.source = 'fold-hide'}

# Filter for year and continent
child_mortality_df <- child_mortality_df %>%
  filter(Year %in% c(1987, 1997, 2007, 2017) &
           Continent %in% c("Oceania", "World"))
# Create ordered factor for year
child_mortality_df$Year <- factor(child_mortality_df$Year, ordered = TRUE, levels = c("1987", "1997", "2007", "2017"))
child_mortality_df

```


## Plot [ Views / Temporals ]


```{r, message=FALSE, warning=FALSE, echo=TRUE, class.source = 'fold-hide', fig.width=12, fig.height=8, fig.align='center', out.width="100%"}

color_palette <- c("Kiribati" = "gray", 
                   "Papua New Guinea" = "gray", 
                   "Nauru" = "gray", 
                   "Tuvalu" = "gray",
                   "Micronesia" = "gray",
                   "Marshall Islands" = "gray",
                   "Vanuatu" = "gray",
                   "Solomon Islands" = "gray",
                   "Palau" = "gray",
                   "Samoa" = "gray",
                   "Fiji" = "gray",
                   "Tonga" = "gray",
                   "New Zealand" = "gray",
                   "Australia" = "gray",
                   "World" = "red")

slope_specs <- list(  
  # move the x axis labels up top
  scale_x_discrete(position = "top"),
  theme_bw(),
  # Format tweaks
  # Remove the legend
  theme(legend.position = "none"),
  # Remove the panel border
  theme(panel.border     = element_blank()),
  # Remove just about everything from the y axis
  theme(axis.title.y     = element_blank()),
  theme(axis.text.y      = element_blank()),
  theme(panel.grid.major.y = element_blank()),
  theme(panel.grid.minor.y = element_blank()),
  # Remove a few things from the x axis and increase font size
  theme(axis.title.x     = element_blank()),
  theme(panel.grid.major.x = element_blank()),
  theme(axis.text.x.top      = element_text(size=12)),
  # Remove x & y tick marks
  theme(axis.ticks       = element_blank()),
  # Format title & subtitle
  theme(plot.title       = element_text(size=14, face = "bold")),
  theme(plot.subtitle    = element_text())
)

child_mortality <- ggplot(data = child_mortality_df, aes(x = Year, y = Mortality_Rate, group = Entity)) +
  geom_line(aes(color = Entity), size = 0.5, alpha = 1) +
  geom_text_repel(data = child_mortality_df %>% filter(Year == "1987"), 
                  aes(label = paste0(Entity)) , 
                  force = 1,
                  hjust = "left", 
                  fontface = "bold", 
                  size = 2.5, 
                  nudge_x = -.5, 
                  direction = "y",
                  segment.color = "gray") +
  geom_text_repel(data = child_mortality_df %>% filter(Year == "2017"), 
                  aes(label = paste0(Entity)) , 
                  force = 1,
                  hjust = "right", 
                  fontface = "bold", 
                  size = 2.5, 
                  nudge_x = .5, 
                  direction = "y",
                  segment.color = "gray") +
  geom_point(color="white", size = 8, alpha = 1) +
  geom_text(aes(label = Mortality_Rate), color="black", size = 2.5, alpha = 1) +
  scale_fill_manual(values = color_palette) +
  scale_color_manual(values = color_palette) +
  slope_specs +
  labs(
    title = "Child Mortality by Country",
    subtitle = "Oceania, The child mortality rate is the share of children who die before reaching the age of five.",
    caption = "source: Our World in Data"
  )

girafe(ggobj = child_mortality, width_svg = 13, height_svg = 7,
       options = list(opts_sizing(rescale = TRUE, width = 1.0)))

```



```{r, message=FALSE, warning=FALSE, echo=TRUE, class.source = 'fold-hide'}

# Save plot to svg file
# width and height defined for kamino aspect ratio
# ggsave(filename = "life-expectancy.svg", plot = child_mortality, width=13.33, height=7.5)

```


# Exercises and practice
## Knime and R practice solutions



# References
## The citations and data sources used for this case

<a href="https://ourworldindata.org/grapher/child-mortality-1990-vs-2017-slope?tab=chart&stackMode=absolute&country=&region=World">Child Mortality</a>
<a href="https://ourworldindata.org/grapher/maternal-mortality-slope-chart?time=1990..latest&country=ARG~BOL~BRA~ECU~GUY~URY~VEN~PRY~PER~SUR~CHL~COL">Maternal Mortality</a>

```{r generateBibliography, echo=FALSE, eval=TRUE, message=FALSE, warning=FALSE}

# cleanbib()
# read.bibtex(file = "./citations.bib")

```



```{js, message=FALSE, warning=FALSE, echo=FALSE}

// Must be included to position footer
$(function() {
  $('.main-container').after($('.footer'));
})

```


