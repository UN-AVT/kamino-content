---
pagetitle: "Post-War Surplus of Women"
output:
  html_document:
    theme: lumen
    css: "../../../z-assemblers/assets/styles/content.css"
    df_print: paged
    mathjax: NULL
    code_folding: show
    include:
      in_header: ["../../../z-assemblers/fragments/google-analytics.html", "../../../z-assemblers/fragments/header.html"]
      after_body: "../../../z-assemblers/fragments/footer.html"
    self_contained: false
    lib_dir: "vendor"
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(message=FALSE, warning=FALSE, echo = FALSE)
options(scipen = 999) ## To disable scientific notation

# Clear environment and memory
rm(list = ls(all.names = TRUE)) #will clear all objects includes hidden objects.
gc() #free up memrory and report the memory usage.

library(dplyr)
library(magrittr)
library(ggplot2)
require(ggrepel)
library(scales)
library(ggiraph)
library(wesanderson)

library(knitcitations)
library(bibtex)

```

<div class="activity">
TEMPORALS
</div>

# Slope Plot
## Cancer Survival Rates

<p>Defined by Edward Tufte in his 1983 book The Visual Display of Quantitative Information, this type of chart is useful for seeing trends over time and comparison among the subjects (categorical) measured.</p>


***

## Load data [Ingest]

```{r, message=FALSE, warning=FALSE, echo=TRUE, class.source = 'fold-hide'}

# Load csv data file
survival_rate_df = read.csv("archetypes/cancer-survival-rates/cancer-survival-rates.csv", header = TRUE, stringsAsFactors = FALSE)
survival_rate_df

```


## Prepare data [Wrangle]


```{r, message=FALSE, warning=FALSE, echo=TRUE, class.source = 'fold-hide'}

# Create ordered factor for year
survival_rate_df$Year <- factor(survival_rate_df$Year, ordered = TRUE, levels = c("5 Year", "10 Year", "15 Year", "20 Year"))
survival_rate_df

```

## Plot [ Views / Temporals ]

```{r, message=FALSE, warning=FALSE, echo=TRUE, class.source = 'fold-hide', fig.width=12, fig.height=8, , fig.align='center', out.width="100%"}

palette <- wes_palette("Zissou1", 21, type = "continuous")

slope_specs <- list(  
  # move the x axis labels up top
  scale_x_discrete(position = "top"),
  theme_bw(),
  # Format tweaks
  # Remove the legend
  theme(legend.position = "none"),
  # Remove the panel border
  theme(panel.border     = element_blank()),
  # Remove just about everything from the y axis
  theme(axis.title.y     = element_blank()),
  theme(axis.text.y      = element_blank()),
  theme(panel.grid.major.y = element_blank()),
  theme(panel.grid.minor.y = element_blank()),
  # Remove a few things from the x axis and increase font size
  theme(axis.title.x     = element_blank()),
  theme(panel.grid.major.x = element_blank()),
  theme(axis.text.x.top      = element_text(size=12)),
  # Remove x & y tick marks
  theme(axis.ticks       = element_blank()),
  # Format title & subtitle
  theme(plot.title       = element_text(size=14, face = "bold")),
  theme(plot.subtitle    = element_text())
)

survival_rate = ggplot(data = survival_rate_df, aes(x = Year, y = Rate, group = Name)) +
  geom_line(aes(color = Rate), size = 0.5, alpha = 1) +
  geom_text_repel(data = survival_rate_df %>% filter(Year == "5 Year"), 
                  aes(label = paste0(Name)) , 
                  force = 1,
                  hjust = "left", 
                  fontface = "bold", 
                  size = 2.5, 
                  nudge_x = -.5, 
                  direction = "y",
                  segment.color = "gray") +
  geom_text_repel(data = survival_rate_df %>% filter(Year == "20 Year"), 
                  aes(label = paste0(Name)), 
                  force = 1,
                  hjust = "right", 
                  fontface = "bold", 
                  size = 2.5, 
                  nudge_x = .5, 
                  direction = "y",
                  segment.color = "gray") +
  geom_point(aes(fill = Rate), shape = 21, color="white", size = 2, stroke = 0.75, alpha = 1) +
  # geom_text(aes(label = Rate), color="black", size = 2.5, alpha = 1) +
  geom_text_repel(aes(label = Rate), color="black", size = 2.5, alpha = 1,
                  force = 1,
                  hjust = "center", 
                  #fontface = "bold", 
                  size = 2.0, 
                  # nudge_x = 0, 
                  direction = "y",
                  segment.color = "gray") +
  scale_fill_gradientn(colours = palette) + 
  scale_color_gradientn(colours = palette) + 
  slope_specs +
  labs(
    title = "Estimates of Relative Survival Rates",
    subtitle = "by cancer site",
    caption = "source: Hermann Brenner, Long-term survival rates of cancer patients achieved by the end of the 20th century: a period analysis, The Lancet, 360 (October 12, 2002), 1131-1135."
  )

girafe(ggobj = survival_rate, width_svg = 13, height_svg = 7,
       options = list(opts_sizing(rescale = TRUE, width = 1.0)))

```



```{r, message=FALSE, warning=FALSE, echo=TRUE, class.source = 'fold-hide'}

# Save plot to svg file
# width and height defined for kamino aspect ratio
# ggsave(filename = "cancer-survival-rates.svg", plot = survival_rate, width=13.33, height=7.5)

```


# Exercises and practice
## Knime and R practice solutions



# References
## The citations and data sources used for this case



```{r generateBibliography, echo=FALSE, eval=TRUE, message=FALSE, warning=FALSE}

# cleanbib()
# read.bibtex(file = "./citations.bib")

```



```{js, message=FALSE, warning=FALSE, echo=FALSE}

// Must be included to position footer
$(function() {
  $('.main-container').after($('.footer'));
})

```

