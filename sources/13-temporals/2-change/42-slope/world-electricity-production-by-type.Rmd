---
pagetitle: "Kamino"
output: 
  html_document:
    theme: lumen
    # css: ["../../../z-assemblers/assets/styles/content/kamino.css", "../../../z-assemblers/assets/icons/line-awesome/css/line-awesome.css"]
    df_print: paged
    mathjax: NULL
    code_folding: show
    include:
      # in_header: "../../../z-assemblers/fragments/header.html"
      # after_body: "../../../z-assemblers/fragments/footer.html"
    #self_contained: false
    #lib_dir: libs
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(message=FALSE, warning=FALSE, echo = FALSE)
options(scipen = 999) ## To disable scientific notation

# Clear environment and memory
rm(list = ls(all.names = TRUE)) #will clear all objects includes hidden objects.
gc() #free up memrory and report the memory usage.

library(knitr)
library(dplyr)
library(magrittr)
library(ggplot2)
require(ggrepel)
library(scales)
library(patchwork)

library(knitcitations)
library(bibtex)

```

<div class="activity">
TEMPORALS
</div>

# Slope Plot by Facet
## World Electricity Production by Type


***

## Load data [Ingest]

```{r, echo=FALSE}

# Load csv data file
electricity_production_df = read.csv("archetypes/world-electricity-production-by-type/world-electricity-production-by-type.csv", header = TRUE, stringsAsFactors = FALSE)
electricity_production_df

```


## Prepare data [Wrangle]


```{r, message=FALSE, warning=FALSE, echo=TRUE, class.source = 'fold-hide'}

# RowIDs, Year, Measure, Country_Name,	Country_Code,	Series_Name,	Series_Code

# Create ordered factor for year
electricity_production_df$Year <- factor(electricity_production_df$Year, ordered = TRUE, levels = c("2005", "2015"))

electricity_production_df

# Filter by country
# Belarus
electricity_production_blr <- electricity_production_df %>%
  filter(Country_Code %in% c("BLR"))

# Bulgaria
electricity_production_bgr <- electricity_production_df %>%
  filter(Country_Code %in% c("BGR"))

# Czechia
electricity_production_cze <- electricity_production_df %>%
  filter(Country_Code %in% c("CZE"))

# Ethiopia
electricity_production_eth <- electricity_production_df %>%
  filter(Country_Code %in% c("ETH"))

# Poland
electricity_production_pol <- electricity_production_df %>%
  filter(Country_Code %in% c("POL"))

# Republic of Moldova
electricity_production_mda <- electricity_production_df %>%
  filter(Country_Code %in% c("MDA"))

# Romania
electricity_production_rou <- electricity_production_df %>%
  filter(Country_Code %in% c("ROU"))

# Russian Federation
electricity_production_rus <- electricity_production_df %>%
  filter(Country_Code %in% c("RUS"))

# Slovakia
electricity_production_svk <- electricity_production_df %>%
  filter(Country_Code %in% c("SVK"))

# Ukraine
electricity_production_ukr <- electricity_production_df %>%
  filter(Country_Code %in% c("UKR"))

```


## Plot [ Views / Temporals ]


```{r, echo=FALSE}

color_palette <- c("EG.ELC.COAL.ZS" = "#d8472b", 
                   "EG.ELC.HYRO.ZS" = "#7dbfe6", 
                   "EG.ELC.NGAS.ZS" = "#eaaa61", 
                   "EG.ELC.NUCL.ZS" = "#f3d469",
                   "EG.ELC.PETR.ZS" = "#777777",
                   "EG.ELC.RNWX.ZS" = "#51a09e")

slope_specs <- list(  
  # move the x axis labels up top
  scale_x_discrete(expand = expansion(mult = c(0.3, 0.9)), position = "top"),
  ylim(0, 100), # to make all scales comparable
  theme_bw(),
  # Format tweaks
  theme(plot.margin = margin(.25, .25, .25, .25, "cm")),
  theme(panel.spacing = unit(c(.5, 1, .5, .5), "cm")),
  theme(axis.ticks.length = unit(0, "null")),
  # theme(axis.ticks.margin = unit(0, "null")),
  # theme(legend.margin = unit(0, "null")),
  # Remove the legend
  theme(legend.position = "none"),
  theme(plot.background = element_rect(fill = "#f5f5f5")),
  theme(panel.background = element_rect(fill = "#ebebeb")),
  # Remove the panel border
  theme(panel.border     = element_blank()),
  # Remove just about everything from the y axis
  theme(axis.title.y     = element_blank()),
  theme(axis.text.y      = element_blank()),
  theme(panel.grid.major.y = element_blank()),
  theme(panel.grid.minor.y = element_blank()),
  # Remove a few things from the x axis and increase font size
  theme(axis.title.x     = element_blank()),
  theme(panel.grid.major.x = element_blank()),
  theme(axis.text.x.top      = element_text(size=9)),
  # Remove x & y tick marks
  theme(axis.ticks       = element_blank()),
  # Format title & subtitle
  theme(plot.title       = element_text(size=10, face = "bold")),
  theme(plot.subtitle    = element_text())
)

```


Belarus


```{r, echo=FALSE, fig.width=4, fig.height=7.5}

bgr_plot = ggplot(data = electricity_production_bgr, aes(x = Year, y = Measure, group = Series_Code)) +
  geom_line(aes(color = Series_Code), size = 0.75, alpha = 1) +
  geom_text_repel(data = electricity_production_bgr %>% filter(Year == "2015"), 
                  aes(label = paste0(Series_Name)) , 
                  force = 1,
                  hjust = "left", 
                  #fontface = "bold", 
                  size = 2.5, 
                  nudge_x = .25, 
                  direction = "y",
                  segment.color = "gray") +
  # shape = 21, colour = "black", fill = "white", size = 5, stroke = 5
  geom_point(aes(fill = Series_Code), shape = 21, color="white", size = 2, stroke = 0.75, alpha = 1) +
  geom_text_repel(aes(label = paste0(round(Measure, digits=0), "%")) , 
                  force = 1,
                  hjust = "center", 
                  #fontface = "bold", 
                  size = 2.0, 
                  # nudge_x = 0, 
                  direction = "y",
                  segment.color = "gray") +
  scale_fill_manual(values = color_palette) +
  scale_color_manual(values = color_palette) +
  slope_specs +
  labs(x=NULL, y=NULL) +
  labs(
    title = "Belarus"
  )

# bgr_plot

```

Bulgaria

```{r, echo=FALSE, fig.width=4, fig.height=7.5}

blr_plot = ggplot(data = electricity_production_blr, aes(x = Year, y = Measure, group = Series_Code)) +
  geom_line(aes(color = Series_Code), size = 0.75, alpha = 1) +
  geom_text_repel(data = electricity_production_blr %>% filter(Year == "2015"), 
                  aes(label = paste0(Series_Name)) , 
                  force = 1,
                  hjust = "left", 
                  #fontface = "bold", 
                  size = 2.5, 
                  nudge_x = .25, 
                  direction = "y",
                  segment.color = "gray") +
  # shape = 21, colour = "black", fill = "white", size = 5, stroke = 5
  geom_point(aes(fill = Series_Code), shape = 21, color="white", size = 2, stroke = 0.75, alpha = 1) +
  geom_text_repel(aes(label = paste0(round(Measure, digits=0), "%")) , 
                  force = 1,
                  hjust = "center", 
                  #fontface = "bold", 
                  size = 2.0, 
                  # nudge_x = 0, 
                  direction = "y",
                  segment.color = "gray") +
  scale_fill_manual(values = color_palette) +
  scale_color_manual(values = color_palette) +
  slope_specs +
  labs(
    title = "Bulgaria"
  )

# blr_plot

```

Czechia

```{r, echo=FALSE, fig.width=4, fig.height=7.5}

cze_plot = ggplot(data = electricity_production_cze, aes(x = Year, y = Measure, group = Series_Code)) +
  geom_line(aes(color = Series_Code), size = 0.75, alpha = 1) +
  geom_text_repel(data = electricity_production_cze %>% filter(Year == "2015"), 
                  aes(label = paste0(Series_Name)) , 
                  force = 1,
                  hjust = "left", 
                  #fontface = "bold", 
                  size = 2.5, 
                  nudge_x = .25, 
                  direction = "y",
                  segment.color = "gray") +
  # shape = 21, colour = "black", fill = "white", size = 5, stroke = 5
  geom_point(aes(fill = Series_Code), shape = 21, color="white", size = 2, stroke = 0.75, alpha = 1) +
  geom_text_repel(aes(label = paste0(round(Measure, digits=0), "%")) , 
                  force = 1,
                  hjust = "center", 
                  #fontface = "bold", 
                  size = 2.0, 
                  # nudge_x = 0, 
                  direction = "y",
                  segment.color = "gray") +
  scale_fill_manual(values = color_palette) +
  scale_color_manual(values = color_palette) +
  slope_specs +
  labs(x=NULL, y=NULL) +
  labs(
    title = "Czechia"
  )

# cze_plot

```

Ethiopia

```{r, echo=FALSE, fig.width=4, fig.height=7.5}

eth_plot = ggplot(data = electricity_production_eth, aes(x = Year, y = Measure, group = Series_Code)) +
  geom_line(aes(color = Series_Code), size = 0.75, alpha = 1) +
  geom_text_repel(data = electricity_production_eth %>% filter(Year == "2015"), 
                  aes(label = paste0(Series_Name)) , 
                  force = 1,
                  hjust = "left", 
                  #fontface = "bold", 
                  size = 2.5, 
                  nudge_x = .25, 
                  direction = "y",
                  segment.color = "gray") +
  # shape = 21, colour = "black", fill = "white", size = 5, stroke = 5
  geom_point(aes(fill = Series_Code), shape = 21, color="white", size = 2, stroke = 0.75, alpha = 1) +
  geom_text_repel(aes(label = paste0(round(Measure, digits=0), "%")) , 
                  force = 1,
                  hjust = "center", 
                  #fontface = "bold", 
                  size = 2.0, 
                  # nudge_x = 0, 
                  direction = "y",
                  segment.color = "gray") +
  scale_fill_manual(values = color_palette) +
  scale_color_manual(values = color_palette) +
  slope_specs +
  labs(x=NULL, y=NULL) +
  labs(
    title = "Ethiopia"
  )

# eth_plot

```

Poland

```{r, echo=FALSE, fig.width=4, fig.height=7.5}

pol_plot = ggplot(data = electricity_production_pol, aes(x = Year, y = Measure, group = Series_Code)) +
  geom_line(aes(color = Series_Code), size = 0.75, alpha = 1) +
  geom_text_repel(data = electricity_production_pol %>% filter(Year == "2015"), 
                  aes(label = paste0(Series_Name)) , 
                  force = 1,
                  hjust = "left", 
                  #fontface = "bold", 
                  size = 2.5, 
                  nudge_x = .25, 
                  direction = "y",
                  segment.color = "gray") +
  # shape = 21, colour = "black", fill = "white", size = 5, stroke = 5
  geom_point(aes(fill = Series_Code), shape = 21, color="white", size = 2, stroke = 0.75, alpha = 1) +
  geom_text_repel(aes(label = paste0(round(Measure, digits=0), "%")) , 
                  force = 1,
                  hjust = "center", 
                  #fontface = "bold", 
                  size = 2.0, 
                  # nudge_x = 0, 
                  direction = "y",
                  segment.color = "gray") +
  scale_fill_manual(values = color_palette) +
  scale_color_manual(values = color_palette) +
  slope_specs +
  labs(x=NULL, y=NULL) +
  labs(
    title = "Poland"
  )

# pol_plot

```

Republic of Moldova

```{r, echo=FALSE, fig.width=4, fig.height=7.5}

mda_plot = ggplot(data = electricity_production_mda, aes(x = Year, y = Measure, group = Series_Code)) +
  geom_line(aes(color = Series_Code), size = 0.75, alpha = 1) +
  geom_text_repel(data = electricity_production_mda %>% filter(Year == "2015"), 
                  aes(label = paste0(Series_Name)) , 
                  force = 1,
                  hjust = "left", 
                  #fontface = "bold", 
                  size = 2.5, 
                  nudge_x = .25, 
                  direction = "y",
                  segment.color = "gray") +
  # shape = 21, colour = "black", fill = "white", size = 5, stroke = 5
  geom_point(aes(fill = Series_Code), shape = 21, color="white", size = 2, stroke = 0.75, alpha = 1) +
  geom_text_repel(aes(label = paste0(round(Measure, digits=0), "%")) , 
                  force = 1,
                  hjust = "center", 
                  #fontface = "bold", 
                  size = 2.0, 
                  # nudge_x = 0, 
                  direction = "y",
                  segment.color = "gray") +
  scale_fill_manual(values = color_palette) +
  scale_color_manual(values = color_palette) +
  slope_specs +
  labs(x=NULL, y=NULL) +
  labs(
    title = "Republic of Moldova"
  )

# mda_plot

```

Romania

```{r, echo=FALSE, fig.width=4, fig.height=7.5}

rou_plot = ggplot(data = electricity_production_rou, aes(x = Year, y = Measure, group = Series_Code)) +
  geom_line(aes(color = Series_Code), size = 0.75, alpha = 1) +
  geom_text_repel(data = electricity_production_rou %>% filter(Year == "2015"), 
                  aes(label = paste0(Series_Name)) , 
                  force = 1,
                  hjust = "left", 
                  #fontface = "bold", 
                  size = 2.5, 
                  nudge_x = .25, 
                  direction = "y",
                  segment.color = "gray") +
  # shape = 21, colour = "black", fill = "white", size = 5, stroke = 5
  geom_point(aes(fill = Series_Code), shape = 21, color="white", size = 2, stroke = 0.75, alpha = 1) +
  geom_text_repel(aes(label = paste0(round(Measure, digits=0), "%")) , 
                  force = 1,
                  hjust = "center", 
                  #fontface = "bold", 
                  size = 2.0, 
                  # nudge_x = 0, 
                  direction = "y",
                  segment.color = "gray") +
  scale_fill_manual(values = color_palette) +
  scale_color_manual(values = color_palette) +
  slope_specs +
  labs(x=NULL, y=NULL) +
  labs(
    title = "Romania"
  )

# rou_plot

```

Russian Federation

```{r, echo=FALSE, fig.width=4, fig.height=7.5}

rus_plot = ggplot(data = electricity_production_rus, aes(x = Year, y = Measure, group = Series_Code)) +
  geom_line(aes(color = Series_Code), size = 0.75, alpha = 1) +
  geom_text_repel(data = electricity_production_rus %>% filter(Year == "2015"), 
                  aes(label = paste0(Series_Name)) , 
                  force = 1,
                  hjust = "left", 
                  #fontface = "bold", 
                  size = 2.5, 
                  nudge_x = .25, 
                  direction = "y",
                  segment.color = "gray") +
  # shape = 21, colour = "black", fill = "white", size = 5, stroke = 5
  geom_point(aes(fill = Series_Code), shape = 21, color="white", size = 2, stroke = 0.75, alpha = 1) +
  geom_text_repel(aes(label = paste0(round(Measure, digits=0), "%")) , 
                  force = 1,
                  hjust = "center", 
                  #fontface = "bold", 
                  size = 2.0, 
                  # nudge_x = 0, 
                  direction = "y",
                  segment.color = "gray") +
  scale_fill_manual(values = color_palette) +
  scale_color_manual(values = color_palette) +
  slope_specs +
  labs(x=NULL, y=NULL) +
  labs(
    title = "Russian Federation"
  )

# rus_plot

```

Slovakia

```{r, echo=FALSE, fig.width=4, fig.height=7.5}

svk_plot = ggplot(data = electricity_production_svk, aes(x = Year, y = Measure, group = Series_Code)) +
  geom_line(aes(color = Series_Code), size = 0.75, alpha = 1) +
  geom_text_repel(data = electricity_production_svk %>% filter(Year == "2015"), 
                  aes(label = paste0(Series_Name)) , 
                  force = 1,
                  hjust = "left", 
                  #fontface = "bold", 
                  size = 2.5, 
                  nudge_x = .25, 
                  direction = "y",
                  segment.color = "gray") +
  # shape = 21, colour = "black", fill = "white", size = 5, stroke = 5
  geom_point(aes(fill = Series_Code), shape = 21, color="white", size = 2, stroke = 0.75, alpha = 1) +
  geom_text_repel(aes(label = paste0(round(Measure, digits=0), "%")) , 
                  force = 1,
                  hjust = "center", 
                  #fontface = "bold", 
                  size = 2.0, 
                  # nudge_x = 0, 
                  direction = "y",
                  segment.color = "gray") +
  scale_fill_manual(values = color_palette) +
  scale_color_manual(values = color_palette) +
  slope_specs +
  labs(x=NULL, y=NULL) +
  labs(
    title = "Slovakia"
  )

# svk_plot

```

Ukraine

```{r, echo=FALSE, fig.width=4, fig.height=7.5}

ukr_plot = ggplot(data = electricity_production_ukr, aes(x = Year, y = Measure, group = Series_Code)) +
  geom_line(aes(color = Series_Code), size = 0.75, alpha = 1) +
  geom_text_repel(data = electricity_production_ukr %>% filter(Year == "2015"), 
                  aes(label = paste0(Series_Name)) , 
                  force = 1,
                  hjust = "left", 
                  #fontface = "bold", 
                  size = 2.5, 
                  nudge_x = .25, 
                  direction = "y",
                  segment.color = "gray") +
  # shape = 21, colour = "black", fill = "white", size = 5, stroke = 5
  geom_point(aes(fill = Series_Code), shape = 21, color="white", size = 2, stroke = 0.75, alpha = 1) +
  geom_text_repel(aes(label = paste0(round(Measure, digits=0), "%")) , 
                  force = 1,
                  hjust = "center", 
                  #fontface = "bold", 
                  size = 2.0, 
                  # nudge_x = 0, 
                  direction = "y",
                  segment.color = "gray") +
  scale_fill_manual(values = color_palette) +
  scale_color_manual(values = color_palette) +
  slope_specs +
  labs(x=NULL, y=NULL) +
  labs(
    title = "Ukraine"
  )

# ukr_plot

```

## Assemble

```{r, message=FALSE, warning=FALSE, echo=TRUE, class.source = 'fold-hide', fig.width=12, fig.height=8, fig.align='center', out.width="100%"}

patch = bgr_plot + blr_plot + cze_plot + eth_plot + pol_plot + mda_plot + rou_plot + rus_plot + svk_plot + ukr_plot + plot_layout(ncol=5, nrow=2)
patch

```



```{r, echo=FALSE}

# Save plot to svg file
# width and height defined for kamino aspect ratio
# ggsave(filename = "world-electricity-production-by-type.svg", plot = patch, width=13.33, height=7.5)

```



# References
## The citations and data sources used for this case can be found here

<a href="https://www.npr.org/2015/09/10/319535020/coal-gas-nuclear-hydro-how-your-state-generates-power" target="_blank"
>Coal, Gas, Nuclear, Hydro? How Your State Generates Power</a>


```{r generateBibliography, echo=FALSE, eval=TRUE, message=FALSE, warning=FALSE}

 cleanbib()
 read.bibtex(file = "citations/world-electricity-production-by-type.bib")

```



```{js, message=FALSE, warning=FALSE, echo=FALSE}

// Must be included to position footer
$(function() {
  $('.main-container').after($('.footer'));
})

```

