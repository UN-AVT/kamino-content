---
pagetitle: "GA Voting - multiple topics"
output: 
  html_document:
    theme: lumen
    css: "../../../z-assemblers/assets/styles/content.css"
    df_print: paged
    mathjax: NULL
    code_folding: show
    include:
      in_header: ["../../../z-assemblers/fragments/google-analytics.html", "../../../z-assemblers/fragments/header.html"]
      after_body: "../../../z-assemblers/fragments/footer.html"
    self_contained: false
    lib_dir: vendor
---

```{r, include=FALSE}
knitr::opts_chunk$set(message=FALSE, warning=FALSE, echo = FALSE)
options(scipen = 999) ## To disable scientific notation

# Clear environment and memory
rm(list = ls(all.names = TRUE)) #will clear all objects includes hidden objects.
gc() #free up memory and report the memory usage.

library(magrittr)
library(tidyverse)
library(ggpubr)
library(ggrepel)
library(ggiraph)
library(ggthemes)

```

<div class="activity">
Qualitative Analysis and Machine Learning
</div>

# How did they vote? - United Nations General Assembly Voting patterns
## Multidimensional scaling

```{r, out.width="60%", fig.align="center", fig.cap="Photo by Daryan Shamkhali on Unsplash"}

masthead <- "assets/daryan-shamkhali-UIWGPEuLE4k-unsplash.jpg"
knitr::include_graphics(masthead, dpi=72)

```

> ...75 years since its founding, the General Assembly remains the global forum where all countries have a voice.\
--- Antonio Guterres, United Nations Secretary-General, 10 January 2021

<a href="https://en.wikipedia.org/wiki/Multidimensional_scaling">__Multidimensional scaling__</a> is a technique that aims to visualize the level of __similarity__ among individual points in a dataset.

The resulting visual is a __scatter plot__ where data points appear to __attract__ and __repeal__ each other within the same quadrant.

***

### Ingest

```{r, message=FALSE, warning=FALSE, echo=TRUE, class.source='fold-hide'}
load("archetypes/un-votes.RData")
df_ref <- read_csv("archetypes/CountryRefData.csv")

country_displayed = c("China", "France", "United States of America", 
                      "United Kingdom of Great Britain and Northern Ireland", "Russian Federation", 
                      "Israel", "iran_Iran (Islamic Republic of)", "India", "Pakistan", "Ethiopia")

```

#### List of topics included in this dataset

__Issue code__  
* ME: Votes relating to the Palestinian conflict (19%)  
* NU: Votes relating to nuclear weapons and nuclear material (13%)  
* DI: Votes relating to arms control and disarmament (16%)  
* CO: Votes relating to colonialism (18%)  
* HR: Votes relating to human rights (17%)  
* EC: Votes relating to (economic) development (9%)   


### ME: Votes relating to the Palestinian conflict (19%)  

```{r, message=FALSE, warning=FALSE, echo=TRUE, class.source='fold-hide'}

df <- completeVotes %>% 
  filter(me == 1, !vote == 9, nchar(Country) == 3) %>%
  select(vote, Country, Countryname, year, resid) %>%
  mutate(digit_vote = case_when(
    vote == 1 ~ 2,
    #vote == 2 ~ 1,
    vote == 3 ~ 0,
    TRUE ~ 1
  ))

df_1 <- df %>%
  group_by(Country, resid) %>%
  filter(n()==1)

df_2 <- df_1 %>%
  select(Country, resid, digit_vote) %>%
  pivot_wider(., names_from=resid, values_from=digit_vote) %>%
  replace(is.na(.), 1)
  
df_3 <- df_2 %>%
  select(-`Country`)

# Compute MDS
mds <- df_3 %>%
  dist() %>%          
  cmdscale() %>%
  as_tibble()

# K-means clustering
clust <- kmeans(mds, 5)$cluster %>%
  as.factor()

mds <- mds %>%
  mutate(groups = clust)

df_me <- data.frame(country = df_3$Country, 
                                     dim1 = mds$V1, 
                                     dim2 = mds$V2, 
                                     groups = mds$groups,
                    topic="Palestinian conflict")

df_joined <- inner_join(df_me, df_ref, by=c("country" = "CountryCode")) %>%
  mutate(groups = as_factor(groups)) %>%
  mutate(point_size = if_else(country == "ETH", 50, 40)) %>%
  mutate(point_alpha = if_else(country == "ETH", 1, 1))


```


```{r, message=FALSE, warning=FALSE, echo=TRUE, class.source='fold-hide'}
# Plot and color by groups
g3 <- ggplot(df_joined, aes(x = dim1, y = dim2)) +
  geom_point_interactive(
      aes(tooltip = paste0(CountryName,"\n", Region), 
          color = groups, size = point_size, alpha = point_alpha))+ 
  geom_text_repel(aes(label = CountryName), 
                  data = df_joined[df_joined$CountryName %in% country_displayed,], size = 10) +
  theme_tufte(base_size = 15) +
  theme(
        plot.title = element_blank(),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text=element_blank(),
        axis.ticks=element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        legend.position="none",
        plot.margin = unit(c(1, 5, 1, 1), "lines"),
  )

girafe(ggobj = g3, width_svg = 13.0, height_svg = 7.0,
       options = list(opts_sizing(rescale = TRUE, width = 1.0)))

```

### NU: Votes relating to nuclear weapons and nuclear material (13%)   

```{r, message=FALSE, warning=FALSE, echo=TRUE, class.source='fold-hide'}

df <- completeVotes %>% 
  filter(nu == 1, !vote == 9, nchar(Country) == 3) %>%
  select(vote, Country, Countryname, year, resid) %>%
  mutate(digit_vote = case_when(
    vote == 1 ~ 2,
    #vote == 2 ~ 1,
    vote == 3 ~ 0,
    TRUE ~ 1
  ))

df_1 <- df %>%
  group_by(Country, resid) %>%
  filter(n()==1)

df_2 <- df_1 %>%
  select(Country, resid, digit_vote) %>%
  pivot_wider(., names_from=resid, values_from=digit_vote) %>%
  replace(is.na(.), 1)
  
df_3 <- df_2 %>%
  select(-`Country`)

# Compute MDS
mds <- df_3 %>%
  dist() %>%          
  cmdscale() %>%
  as_tibble()

# K-means clustering
clust <- kmeans(mds, 5)$cluster %>%
  as.factor()

mds <- mds %>%
  mutate(groups = clust)

df_mu <- data.frame(country = df_3$Country, 
                                     dim1 = mds$V1, 
                                     dim2 = mds$V2, 
                                     groups = mds$groups,
                    topic="nuclear weapons and nuclear material")

df_joined <- inner_join(df_mu, df_ref, by=c("country" = "CountryCode")) %>%
  mutate(groups = as_factor(groups)) %>%
  mutate(point_size = if_else(country == "ETH", 50, 40)) %>%
  mutate(point_alpha = if_else(country == "ETH", 1, 1))

```


```{r, message=FALSE, warning=FALSE, echo=TRUE, class.source='fold-hide'}
# Plot and color by groups
g3 <- ggplot(df_joined, aes(x = dim1, y = dim2)) +
  geom_point_interactive(
      aes(tooltip = paste0(CountryName,"\n", Region), 
          color = groups, size = point_size, alpha = point_alpha))+ 
  geom_text_repel(aes(label = CountryName), 
                  data = df_joined[df_joined$CountryName %in% country_displayed,], size = 10) +
  theme_tufte(base_size = 15) +
  theme(
        plot.title = element_blank(),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text=element_blank(),
        axis.ticks=element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        legend.position="none",
        plot.margin = unit(c(1, 5, 1, 1), "lines"),
  )

girafe(ggobj = g3, width_svg = 13.0, height_svg = 7.0,
       options = list(opts_sizing(rescale = TRUE, width = 1.0)))

```


### DI: Votes relating to arms control and disarmament (16%)   

```{r, message=FALSE, warning=FALSE, echo=TRUE, class.source='fold-hide'}

df <- completeVotes %>% 
  filter(di == 1, !vote == 9, nchar(Country) == 3) %>%
  select(vote, Country, Countryname, year, resid) %>%
  mutate(digit_vote = case_when(
    vote == 1 ~ 2,
    #vote == 2 ~ 1,
    vote == 3 ~ 0,
    TRUE ~ 1
  ))

df_1 <- df %>%
  group_by(Country, resid) %>%
  filter(n()==1)

df_2 <- df_1 %>%
  select(Country, resid, digit_vote) %>%
  pivot_wider(., names_from=resid, values_from=digit_vote) %>%
  replace(is.na(.), 1)
  
df_3 <- df_2 %>%
  select(-`Country`)

# Compute MDS
mds <- df_3 %>%
  dist() %>%          
  cmdscale() %>%
  as_tibble()

# K-means clustering
clust <- kmeans(mds, 5)$cluster %>%
  as.factor()

mds <- mds %>%
  mutate(groups = clust)

df_di <- data.frame(country = df_3$Country, 
                                     dim1 = mds$V1, 
                                     dim2 = mds$V2, 
                                     groups = mds$groups,
                    topic="arms control and disarmament")

df_joined <- inner_join(df_di, df_ref, by=c("country" = "CountryCode")) %>%
  mutate(groups = as_factor(groups)) %>%
  mutate(point_size = if_else(country == "ETH", 50, 40)) %>%
  mutate(point_alpha = if_else(country == "ETH", 1, 1))

```

```{r, message=FALSE, warning=FALSE, echo=TRUE, class.source='fold-hide'}
# Plot and color by groups
g3 <- ggplot(df_joined, aes(x = dim1, y = dim2)) +
  geom_point_interactive(
      aes(tooltip = paste0(CountryName,"\n", Region), 
          color = groups, size = point_size, alpha = point_alpha))+ 
  geom_text_repel(aes(label = CountryName), 
                  data = df_joined[df_joined$CountryName %in% country_displayed,], size = 10) +
  theme_tufte(base_size = 15) +
  theme(
        plot.title = element_blank(),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text=element_blank(),
        axis.ticks=element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        legend.position="none",
        plot.margin = unit(c(1, 5, 1, 1), "lines"),
  )

girafe(ggobj = g3, width_svg = 13.0, height_svg = 7.0,
       options = list(opts_sizing(rescale = TRUE, width = 1.0)))


```

### CO: Votes relating to colonialism (18%)  

```{r, message=FALSE, warning=FALSE, echo=TRUE, class.source='fold-hide'}

df <- completeVotes %>% 
  filter(co == 1, !vote == 9, nchar(Country) == 3) %>%
  select(vote, Country, Countryname, year, resid) %>%
  mutate(digit_vote = case_when(
    vote == 1 ~ 2,
    #vote == 2 ~ 1,
    vote == 3 ~ 0,
    TRUE ~ 1
  ))

df_1 <- df %>%
  group_by(Country, resid) %>%
  filter(n()==1)

df_2 <- df_1 %>%
  select(Country, resid, digit_vote) %>%
  pivot_wider(., names_from=resid, values_from=digit_vote) %>%
  replace(is.na(.), 1)
  
df_3 <- df_2 %>%
  select(-`Country`)

# Compute MDS
mds <- df_3 %>%
  dist() %>%          
  cmdscale() %>%
  as_tibble()

# K-means clustering
clust <- kmeans(mds, 5)$cluster %>%
  as.factor()

mds <- mds %>%
  mutate(groups = clust)

df_co <- data.frame(country = df_3$Country, 
                                     dim1 = mds$V1, 
                                     dim2 = mds$V2, 
                                     groups = mds$groups,
                    topic="colonialism")

df_joined <- inner_join(df_co, df_ref, by=c("country" = "CountryCode")) %>%
  mutate(groups = as_factor(groups)) %>%
  mutate(point_size = if_else(country == "ETH", 50, 40)) %>%
  mutate(point_alpha = if_else(country == "ETH", 1, 1))

```


```{r, message=FALSE, warning=FALSE, echo=TRUE, class.source='fold-hide'}
# Plot and color by groups
g3 <- ggplot(df_joined, aes(x = dim1, y = dim2)) +
  geom_point_interactive(
      aes(tooltip = paste0(CountryName,"\n", Region), 
          color = groups, size = point_size, alpha = point_alpha))+ 
  geom_text_repel(aes(label = CountryName), 
                  data = df_joined[df_joined$CountryName %in% country_displayed,], size = 10) +
  theme_tufte(base_size = 15) +
  theme(
        plot.title = element_blank(),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text=element_blank(),
        axis.ticks=element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        legend.position="none",
        plot.margin = unit(c(1, 5, 1, 1), "lines"),
  )

girafe(ggobj = g3, width_svg = 13.0, height_svg = 7.0,
       options = list(opts_sizing(rescale = TRUE, width = 1.0)))


```

### HR: Votes relating to human rights (17%)  

```{r, message=FALSE, warning=FALSE, echo=TRUE, class.source='fold-hide'}

df <- completeVotes %>% 
  filter(hr == 1, !vote == 9, nchar(Country) == 3) %>%
  select(vote, Country, Countryname, year, resid) %>%
  mutate(digit_vote = case_when(
    vote == 1 ~ 2,
    #vote == 2 ~ 1,
    vote == 3 ~ 0,
    TRUE ~ 1
  ))

df_1 <- df %>%
  group_by(Country, resid) %>%
  filter(n()==1)

df_2 <- df_1 %>%
  select(Country, resid, digit_vote) %>%
  pivot_wider(., names_from=resid, values_from=digit_vote) %>%
  replace(is.na(.), 1)
  
df_3 <- df_2 %>%
  select(-`Country`)

# Compute MDS
mds <- df_3 %>%
  dist() %>%          
  cmdscale() %>%
  as_tibble()

# K-means clustering
clust <- kmeans(mds, 5)$cluster %>%
  as.factor()

mds <- mds %>%
  mutate(groups = clust)

df_hr <- data.frame(country = df_3$Country, 
                                     dim1 = mds$V1, 
                                     dim2 = mds$V2, 
                                     groups = mds$groups,
                    topic="human rights")

df_joined <- inner_join(df_hr, df_ref, by=c("country" = "CountryCode")) %>%
  mutate(groups = as_factor(groups)) %>%
  mutate(point_size = if_else(country == "ETH", 50, 40)) %>%
  mutate(point_alpha = if_else(country == "ETH", 1, 1))

```

```{r, message=FALSE, warning=FALSE, echo=TRUE, class.source='fold-hide'}
# Plot and color by groups
g3 <- ggplot(df_joined, aes(x = dim1, y = dim2)) +
  geom_point_interactive(
      aes(tooltip = paste0(CountryName,"\n", Region), 
          color = groups, size = point_size, alpha = point_alpha))+ 
  geom_text_repel(aes(label = CountryName), 
                  data = df_joined[df_joined$CountryName %in% country_displayed,], size = 10) +
  theme_tufte(base_size = 15) +
  theme(
        plot.title = element_blank(),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text=element_blank(),
        axis.ticks=element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        legend.position="none",
        plot.margin = unit(c(1, 5, 1, 1), "lines"),
  )

girafe(ggobj = g3, width_svg = 13.0, height_svg = 7.0,
       options = list(opts_sizing(rescale = TRUE, width = 1.0)))


```

### EC: Votes relating to (economic) development (9%)  

```{r, message=FALSE, warning=FALSE, echo=TRUE, class.source='fold-hide'}

df <- completeVotes %>% 
  filter(ec == 1, !vote == 9, nchar(Country) == 3) %>%
  select(vote, Country, Countryname, year, resid) %>%
  mutate(digit_vote = case_when(
    vote == 1 ~ 2,
    #vote == 2 ~ 1,
    vote == 3 ~ 0,
    TRUE ~ 1
  ))

df_1 <- df %>%
  group_by(Country, resid) %>%
  filter(n()==1)

df_2 <- df_1 %>%
  select(Country, resid, digit_vote) %>%
  pivot_wider(., names_from=resid, values_from=digit_vote) %>%
  replace(is.na(.), 1)
  
df_3 <- df_2 %>%
  select(-`Country`)

# Compute MDS
mds <- df_3 %>%
  dist() %>%          
  cmdscale() %>%
  as_tibble()

# K-means clustering
clust <- kmeans(mds, 5)$cluster %>%
  as.factor()

mds <- mds %>%
  mutate(groups = clust)

df_ec <- data.frame(country = df_3$Country, 
                                     dim1 = mds$V1, 
                                     dim2 = mds$V2, 
                                     groups = mds$groups,
                    topic="economic development")

df_joined <- inner_join(df_ec, df_ref, by=c("country" = "CountryCode")) %>%
  mutate(groups = as_factor(groups)) %>%
  mutate(point_size = if_else(country == "ETH", 50, 40)) %>%
  mutate(point_alpha = if_else(country == "ETH", 1, 1))

```

```{r, message=FALSE, warning=FALSE, echo=TRUE, class.source='fold-hide'}
# Plot and color by groups
g3 <- ggplot(df_joined, aes(x = dim1, y = dim2)) +
  geom_point_interactive(
      aes(tooltip = paste0(CountryName,"\n", Region), 
          color = groups, size = point_size, alpha = point_alpha))+ 
  geom_text_repel(aes(label = CountryName), 
                  data = df_joined[df_joined$CountryName %in% country_displayed,], size = 10) +
  theme_tufte(base_size = 15) +
  theme(
        plot.title = element_blank(),
        axis.title.x = element_blank(),
        axis.title.y = element_blank(),
        axis.text=element_blank(),
        axis.ticks=element_blank(),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        legend.position="none",
        plot.margin = unit(c(1, 5, 1, 1), "lines"),
  )

girafe(ggobj = g3, width_svg = 13.0, height_svg = 7.0,
       options = list(opts_sizing(rescale = TRUE, width = 1.0)))


```


### References
#### citations for narrative and data sources

* Data sources: Harvard Dataverse, [GO](https://dataverse.harvard.edu/dataset.xhtml?persistentId=doi:10.7910/DVN/LEJUQZ){target="_blank"}


```{r generateBibliography, echo=FALSE, eval=TRUE, message=FALSE, warning=FALSE}

# cleanbib()
# read.bibtex(file = "./citations.bib")

```



```{js, message=FALSE, warning=FALSE, echo=FALSE}

// Must be included to position footer
$(function() {
  $('.main-container').after($('.footer'));
})

```

