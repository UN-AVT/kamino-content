---
pagetitle: "Kamino"
output: 
  html_document:
    theme: lumen
    css: ["../../../z-assemblers/assets/styles/content/kamino.css", "../../../z-assemblers/assets/icons/line-awesome/css/line-awesome.css"]
    df_print: paged
    mathjax: NULL
    code_folding: show
    include:
      in_header: "../../../z-assemblers/fragments/header.html"
      after_body: "../../../z-assemblers/fragments/footer.html"
    self_contained: false
    lib_dir: libs
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(
    echo = FALSE,
    message = FALSE,
    warning = FALSE,
   dev = "svg"
)
options(scipen = 999) ## To disable scientific notation

# Clear environment and memory
rm(list = ls(all.names = TRUE)) #will clear all objects includes hidden objects.
gc() #free up memrory and report the memory usage.

library(tidyverse)
library(ggplot2)
library(dplyr)
library(stringr)
library(lubridate)
library(DT)
library(caret)
library(leaflet)
library(corrplot)
library(boot)
library(knitcitations)
library(bibtex)
library(ggiraph)
```


<div class="activity">
Qualitative Analysis and Machine Learning
</div>


# Descriptive Analysis
## Case: Manhattan Rent by StreetEasy
#### Descriptive analytics or exploratory analysis is an integral part of the machine-learning process. Descriptive data analysis is the process of interpreting datasets while summarizing their various characteristics with the help of data visualization methods. We need to understand how our variables behave before we feed it into a machine learning model. 


***

## Load data [Ingest]. 
#### The data we have outlines Rent Prices in Manhattan. Note that our label(target) is a continous numerical variable i.e. Rent-Price. We'll be using several features to predict the Rent. 


```{r, message=FALSE, warning=FALSE, echo=TRUE, class.source = 'fold-hide'}

# Load csv data file
df = read.csv("archetypes/manhattan.csv", header = TRUE, stringsAsFactors = FALSE)
df

```



## Let's find out how many NAs (missing values) are there and process them.

```{r, message=FALSE, warning=FALSE, echo=TRUE, class.source = 'fold-hide'}

numbers_of_NA = count(df[!complete.cases(df),])
colnames(numbers_of_NA) <- "numbers_of_NA"
numbers_of_NA

```

## Let's review the datatypes of the data as well as summary statistics of the data. 

```{r, message=FALSE, warning=FALSE, echo=TRUE, class.source = 'fold-hide'}

str(df) #to see datatypes 
summary(df)
table(df$has_gym)

```

## Firstly, we will chart the distribution of the Rent Prices. 

```{r, message=FALSE, warning=FALSE, echo=TRUE, class.source = 'fold-hide', fig.width=10, fig.height=7, fig.align='center'}

  v11<-ggplot(df, aes(x = rent)) +    
  geom_histogram(alpha = 0.8,fill = "#fcb9c6") +
  geom_vline(aes(xintercept = mean(rent)),col='indianred1',size=1)+
  geom_text(aes(x=mean(rent) + 250, label="Mean", y=600), colour="indianred1", angle=90) +
  geom_vline(aes(xintercept = median(rent)),col='steelblue1',size=1)+
  geom_text(aes(x=median(rent) + 250, label="Median", y=600), colour="steelblue1", angle=90) +
  labs(x= 'Price',y = 'Count', title = paste("Distribution of Rent Prices")) +
  theme_bw()


girafe(ggobj = v11, width_svg = 13, height_svg = 7,
       options = list(opts_sizing(rescale = TRUE, width = 1.0)))

```



#### Now we'll examine how the number of bedrooms affect the price. Note that we're using Median Price to tackle Outliers. Outliers such as ultra-luxury apartments will affect mean. 

```{r, message=FALSE, warning=FALSE, echo=TRUE, class.source = 'fold-hide', fig.width=10, fig.height=7, fig.align='center'}

df1 <- df %>%
  group_by(bedrooms) %>%
  summarise(PriceMedian = median(rent)) 

df1$bedrooms <- as.factor(df1$bedrooms)
 
  v12<-ggplot(df1, aes(x = bedrooms,y = PriceMedian)) +
  geom_bar(stat='identity', aes(fill = bedrooms)) +
  geom_text(aes(x = bedrooms, y = 1, label = paste0("(",PriceMedian,")",sep="")),
            hjust=0.5, vjust=2, size = 3, colour = 'black',
            fontface = 'bold') +
    
  labs(x = 'No. of Bedrooms', 
       y = 'Median Price', 
       title = 'Bedrooms and Median Price') 

  
girafe(ggobj = v12, width_svg = 13, height_svg = 7,
       options = list(opts_sizing(rescale = TRUE, width = 1.0)))
```


## Just to showcase the trend

```{r, message=FALSE, warning=FALSE, echo=TRUE, class.source = 'fold-hide', fig.width=10, fig.height=7, fig.align='center'}

v13<- ggplot(df, aes(x=bedrooms,y=rent))+
  geom_point(color = "blue")+
  stat_smooth(aes(x=bedrooms,y=rent),method="lm", color="red")+
  theme_bw()+
  theme(axis.title = element_text(size=16),axis.text = element_text(size=14))+
  xlab("Bedroom")+
  ylab("Price")


girafe(ggobj = v13, width_svg = 13, height_svg = 7,
       options = list(opts_sizing(rescale = TRUE, width = 1.0)))
```





## Neighborhood and Price


```{r, message=FALSE, warning=FALSE, echo=TRUE, class.source = 'fold-hide', fig.width=10, fig.height=18, fig.align='center'}

df2 <- df %>%
  group_by(neighborhood) %>%
  summarise(PriceMedian = median(rent))  %>%
  arrange(desc(PriceMedian))


v14<-ggplot(df2, aes(x = reorder(neighborhood, PriceMedian) ,y = PriceMedian)) +
  geom_bar(stat='identity', aes(fill = neighborhood)) +
  geom_text(aes(x = neighborhood, y = 1, label = paste0("(",PriceMedian,")",sep="")),
            hjust=0, vjust=.5, size = 4, colour = 'black',
            fontface = 'bold') +
  labs(x = 'Neighborhood', 
       y = 'Median Price', 
       title = 'Neighborhood and Median Price') +
  coord_flip() + theme(legend.position = "none")


girafe(ggobj = v14, width_svg = 13, height_svg = 7,
       options = list(opts_sizing(rescale = TRUE, width = 1.0)))
```


## Let's chart some of the catergorical variables of the dataset. 


```{r, message=FALSE, warning=FALSE, echo=TRUE, class.source = 'fold-hide', fig.width=20, fig.height=20, fig.align='center'}

v1 <- df %>%
  group_by(has_gym) %>%
  summarise(PriceMedian = median(rent)) %>%
  
  ggplot(aes(x = has_gym,y = PriceMedian)) +
  geom_bar(stat='identity', aes(fill = has_gym)) +
  labs(x = 'Gym', 
       y = 'Median Price', 
       title = 'Gym and Median Price')+
  guides(fill=FALSE)

v2 <- df %>%
  group_by(no_fee) %>%
  summarise(PriceMedian = median(rent)) %>%
  ggplot(aes(x = no_fee,y = PriceMedian)) +
  geom_bar(stat='identity', aes(fill = no_fee)) +
  labs(x = 'no_fee', 
       y = 'Median Price', 
       title = 'no_fee and Median Price')+
  guides(fill=FALSE)


v3 <- df %>%
  group_by(has_doorman) %>%
  summarise(PriceMedian = median(rent)) %>%
  ggplot(aes(x = has_doorman,y = PriceMedian)) +
  geom_bar(stat='identity', aes(fill = has_doorman)) +
  labs(x = 'has_doorman', 
       y = 'Median Price', 
       title = 'has_doorman and Median Price')+
  guides(fill=FALSE)

v4 <- df %>%
  group_by(has_roofdeck) %>%
  summarise(PriceMedian = median(rent)) %>%
  ggplot(aes(x = has_roofdeck,y = PriceMedian)) +
  geom_bar(stat='identity', aes(fill = has_roofdeck)) +
  labs(x = 'has_roofdeck', 
       y = 'Median Price', 
       title = 'has_roofdeck and Median Price')+
  guides(fill=FALSE)


v5 <- df %>%
  group_by(has_patio) %>%
  summarise(PriceMedian = median(rent)) %>%
  ggplot(aes(x = has_patio,y = PriceMedian)) +
  geom_bar(stat='identity', aes(fill = has_patio)) +
  labs(x = 'has_patio', 
       y = 'Median Price', 
       title = 'has_patio and Median Price')+
  guides(fill=FALSE)


v6 <- df %>%
  group_by(has_washer_dryer) %>%
  summarise(PriceMedian = median(rent)) %>%
  ggplot(aes(x = has_washer_dryer,y = PriceMedian)) +
  geom_bar(stat='identity', aes(fill = has_washer_dryer)) +
  labs(x = 'has_washer_dryer', 
       y = 'Median Price', 
       title = 'has_washer_dryer and Median Price')+
  guides(fill=FALSE)


v7 <-  ggplot(df, aes(x=min_to_subway,y=rent))+
  geom_point(color = "blue")+
  stat_smooth(aes(x=min_to_subway,y=rent),method="lm", color="red")+
   theme_bw()+
  theme(axis.title = element_text(size=16),axis.text = element_text(size=14))+
  xlab("(Minutes to Subway)")+
  ylab("Price")

v8 <- ggplot(df, aes(x=floor,y=rent))+
  geom_point(color = "blue")+
  stat_smooth(aes(x=floor,y=rent),method="lm", color="red")+
   theme_bw()+
  theme(axis.title = element_text(size=16),axis.text = element_text(size=14))+
  xlab("(Floor)")+
  ylab("Price")

v9 <- ggplot(df, aes(x=building_age_yrs,y=rent))+
  geom_point(color = "blue")+
  stat_smooth(aes(x=building_age_yrs,y=rent),method="lm", color="red")+
   theme_bw()+
  theme(axis.title = element_text(size=16),axis.text = element_text(size=14))+
  xlab("(Building Age)")+
  ylab("Price")



library(patchwork)

patch = v1 + v2 + v3 + v4 + v5 + v6 + v7 +v8 +v9 + plot_layout(ncol=3, nrow=3)
#patch


girafe(ggobj = patch, width_svg = 13, height_svg = 7,
       options = list(opts_sizing(rescale = TRUE, width = 1.0)))
```

## As you can see, the above variables doesn't make that much of a difference on Rent. Let's introduce some regression lines to our continuous variables. 


```{r, message=FALSE, warning=FALSE, echo=TRUE, class.source = 'fold-hide', fig.width=10, fig.height=7, fig.align='center'}

 v15<-ggplot(df, aes(x=size_sqft,y=rent))+
  geom_point(color = "blue")+
  
  stat_smooth(aes(x=size_sqft,y=rent),method="lm", color="red")+
  theme_bw()+
  theme(axis.title = element_text(size=16),axis.text = element_text(size=14))+
  xlab("(Sqft Living)")+
  ylab("Price")


girafe(ggobj = v15, width_svg = 13, height_svg = 7,
       options = list(opts_sizing(rescale = TRUE, width = 1.0)))
```


## Our graphs look real neat and tidy, but if you're ever in a hurry and want to quickly observe in a single line of code, you can use the following. 

```{r, message=FALSE, warning=FALSE, echo=TRUE, class.source = 'fold-hide', fig.width=10, fig.height=7, fig.align='center'}

pairs(df[c("rent", "bedrooms", "bathrooms", "size_sqft", "floor")])

```




# References
## The citations and data sources used for this case can be found here 

<a href="https://www.kaggle.com/zohaib30/streeteasy-dataset" target="_blank"> Kaggle StreetEasy DataSet</a>






```{r generateBibliography, echo=FALSE, eval=TRUE, message=FALSE, warning=FALSE}

# cleanbib()
# read.bibtex(file = "./citations.bib")

```



```{js, message=FALSE, warning=FALSE, echo=FALSE}

// Must be included to position footer
$(function() {
  $('.main-container').after($('.footer'));
})

```



