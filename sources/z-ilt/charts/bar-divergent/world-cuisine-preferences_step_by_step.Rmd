---
pagetitle: "Which countries dominate the world’s dinner tables?"
output:
  html_document:
    theme: lumen
    css: "../../../z-assemblers/assets/styles/content.css"
    df_print: paged
    mathjax: NULL
    code_folding: show
    include:
      in_header: ["../../../z-assemblers/fragments/google-analytics.html", "../../../z-assemblers/fragments/header.html"]
      after_body: "../../../z-assemblers/fragments/footer.html"
    self_contained: false
    lib_dir: "vendor"
---


```{r setup, include=FALSE}

library(tidyverse)
library(scales)

```

<div class="activity">
CHARTS
</div>

# Which countries dominate the world’s dinner tables?
## Bar divergent 

A study published in the the Journal of Cultural Economics, *Dining out as cultural trade*, used data from TripAdvisor to examine restaurant cuisines, combined with Euromonitor data on overall and fast-food expenditure. The paper calculated the implicit trade patterns in global cuisines for 52 destination countries.  The research was presented in a Daily Chart segment of the Economist using a bar chart with divergent values.  The chart is designed to reveal how domestic and foreign food consumption profiles can identify which countries have the greatest influence on the world’s cuisine preferences.

* Domestic consumption of foreign cuisine is treated as an __import__
* Foreign consumption of domestic cuisine is treated as an __export__

### Ingest data

```{r, message=FALSE, warning=FALSE, echo=TRUE, class.source = 'fold-hide'}

# Load data
df <- read_csv("archetypes/world-cuisine-preferences/table-6-cuisine-net-exports-excluding-fast-food.csv")
df


```

### Wrangle

* Recalculate net_exports
* Ordering Country in descending order by their net_exports
* Create a column "net_export_type" to color code the Importers and Exporters
* Separate the Importers and Exporters to support labeling

```{r, message=FALSE, warning=FALSE, echo=TRUE, class.source = 'fold-hide'}

df_1 <- df %>%
  select(country = Country, exports = Exports, imports = Imports) %>%
  # Calculate the net exports and fill in the fourth column
  mutate(net_exports = exports - imports)%>% 
  # Remove all missing data
  filter(net_exports!='NA')%>% 
  # Change order of factors to sort from highest to lowest
  mutate(country = factor(country),
         country = fct_reorder(country, net_exports, max)) %>%
  # Make colors based on value threshold
  mutate(net_export_type = if_else(net_exports > 0, "Exporter", "Importer"),
         net_export_type = factor(net_export_type))
      

# Filter dataframe into two parts (countries with positive, or negative next exports) 
# We will use these two dataframes for labels later

df_left <- df_1 %>% 
  filter(net_exports > 0 )

df_right <- df_1 %>% 
  filter(net_exports < 0 )

df_1

```

### Map bars
* x-axis: net_exports  
* y-axis: country  

```{r, message=FALSE, warning=FALSE, echo=TRUE, class.source = 'fold-hide'}

ggplot(df_1, aes(x = net_exports, y =country)) +
  geom_col()
  #geom_bar(stat = "identity")


```

### Adding colors

#### Step 1 - Map color
* color bars based on value of "net_export_type"

```{r, message=FALSE, warning=FALSE, echo=TRUE, class.source = 'fold-hide'}

ggplot(df_1, aes(x = net_exports, y =country, fill = net_export_type)) +
  geom_col()


```

#### Step 2 - Control colors
* Use a manual palette to control colors  

```{r, message=FALSE, warning=FALSE, echo=TRUE, class.source = 'fold-hide'}

color_palette <- c("Exporter" = "#076fa1", "Importer" = "#2fc1d3")

ggplot(df_1, aes(x = net_exports, y =country, fill = net_export_type)) +
  geom_col()+
  scale_fill_manual(values = color_palette)


```

### Adding labels

#### Step 1 - Map country name labels
* Add country names

```{r, message=FALSE, warning=FALSE, echo=TRUE, class.source = 'fold-hide'}

color_palette <- c("Exporter" = "#076fa1", "Importer" = "#2fc1d3")

ggplot(df_1, aes(x = net_exports, y =country, fill = net_export_type)) +
  geom_col() +
  scale_fill_manual(values = color_palette) +
  # Add country name Label for "Exporters"
  # x is "fixed"
  # note for hjust: 1 means right-justified
  geom_text(data = df_left, 
            aes(label = country,x = -110, y = country), 
            size = 4, hjust = 1, color = 'gray30')  +
  # Add country name Label for "Importers"
  geom_text(data = df_right,
            aes(label = country, x = 200, y = country),
            size = 4, hjust = 0, color= 'gray30' )


```

#### Step 2 - Map net_export values labels 
* Add country names

```{r, message=FALSE, warning=FALSE, echo=TRUE, class.source = 'fold-hide'}

color_palette <- c("Exporter" = "#076fa1", "Importer" = "#2fc1d3")

ggplot(df_1, aes(x = net_exports, y =country, fill = net_export_type)) +
  geom_col() +
  scale_fill_manual(values = color_palette) +
  geom_text(data = df_left, 
            aes(label = country,x = -110, y = country), 
            size = 4, hjust = 1, color = 'gray30') +
  geom_text(data = df_right,
            aes(label = country, x = 200, y = country),
            size = 4, hjust = 0, color= 'gray30' ) +
  # Add values label for "Exporters"
  # x is "fixed"
  # note for hjust: 0 means left-justified
  geom_text(data = df_left,
            aes(label = net_exports, x = net_exports, y =country),
            position = position_nudge(x = 125),
            size = 4, hjust = 0, color = 'gray30') +
  # Add country name Label for "Importers"
  geom_text(data = df_right,
            aes(label = net_exports, x = net_exports, y =country),
            position = position_nudge(x = -125),
            size = 4, hjust = 1, color = 'gray30')


```

### Cleaning up, "beautifying" the graph

#### Step 1 - Add vertical red line

```{r, message=FALSE, warning=FALSE, echo=TRUE, class.source = 'fold-hide'}

color_palette <- c("Exporter" = "#076fa1", "Importer" = "#2fc1d3")

ggplot(df_1, aes(x = net_exports, y =country, fill = net_export_type)) +
  geom_col() +
  scale_fill_manual(values = color_palette) +
  geom_text(data = df_left, 
            aes(label = country,x = -110, y = country), 
            size = 4, hjust = 1, color = 'gray30') +
  geom_text(data = df_right, 
            aes(label = country, x = 200, y = country),
            size = 4, hjust = 0, color= 'gray30' ) +
  geom_text(data = df_left, 
            aes(label = net_exports, x = net_exports, y =country), 
            position = position_nudge(x = 125), 
            size = 4, hjust = 0, color = 'gray30') +
  geom_text(data = df_right, 
            aes(label = net_exports, x = net_exports, y =country), 
            position = position_nudge(x = -125), 
            size = 4, hjust = 1, color = 'gray30') +
  # Red Line
  geom_vline(xintercept = 0, colour = "red", linetype = "solid", size = 1.1 )+
  # Manual Annotations
  annotate(geom = "text", x = 51000, y = 'Turkey', label = 'Net\nExporters', color = "#076fa1", size = 6, hjust = 0) +
  annotate(geom = "text", x = -51000, y = 'Australia' , label = 'Net\nImporters', color = "#2fc1d3", size = 6, hjust = 1)


```

#### Step 2 - Add annotations

```{r, message=FALSE, warning=FALSE, echo=TRUE, class.source = 'fold-hide'}

color_palette <- c("Exporter" = "#076fa1", "Importer" = "#2fc1d3")

ggplot(df_1, aes(x = net_exports, y =country, fill = net_export_type)) +
  geom_col() +
  scale_fill_manual(values = color_palette) +
  geom_text(data = df_left, 
            aes(label = country,x = -110, y = country), 
            size = 4, hjust = 1, color = 'gray30') +
  geom_text(data = df_right, 
            aes(label = country, x = 200, y = country),
            size = 4, hjust = 0, color= 'gray30' ) +
  geom_text(data = df_left, 
            aes(label = net_exports, x = net_exports, y =country), 
            position = position_nudge(x = 125), 
            size = 4, hjust = 0, color = 'gray30') +
  geom_text(data = df_right, 
            aes(label = net_exports, x = net_exports, y =country), 
            position = position_nudge(x = -125), 
            size = 4, hjust = 1, color = 'gray30') +
  geom_vline(xintercept = 0, colour = "red", linetype = "solid", size = 1.1 )+
  # Manual Annotations
  # Note: use "\n" within the text to create "multi-lines"
  # use x and y to control where the anntotation will be displayed on the graph
  annotate(geom = "text", 
           x = 51000, 
           y = 'Turkey', 
           label = 'Net\nExporters', 
           color = "#076fa1", size = 6, hjust = 0) +
  annotate(geom = "text", 
           x = -51000, 
           y = 'Australia' , 
           label = 'Net\nImporters', 
           color = "#2fc1d3", size = 6, hjust = 1)


```

#### Step 3 - Choose a theme
* Choose minimal theme 

```{r, message=FALSE, warning=FALSE, echo=TRUE, class.source = 'fold-hide'}

color_palette <- c("Exporter" = "#076fa1", "Importer" = "#2fc1d3")

ggplot(df_1, aes(x = net_exports, y =country, fill = net_export_type)) +
  geom_col() +
  scale_fill_manual(values = color_palette) +
  geom_text(data = df_left, 
            aes(label = country,x = -110, y = country), 
            size = 4, hjust = 1, color = 'gray30') +
  geom_text(data = df_right, 
            aes(label = country, x = 200, y = country),
            size = 4, hjust = 0, color= 'gray30' ) +
  geom_text(data = df_left, 
            aes(label = net_exports, x = net_exports, y =country), 
            position = position_nudge(x = 125), 
            size = 4, hjust = 0, color = 'gray30') +
  geom_text(data = df_right, 
            aes(label = net_exports, x = net_exports, y =country), 
            position = position_nudge(x = -125), 
            size = 4, hjust = 1, color = 'gray30') +
  geom_vline(xintercept = 0, colour = "red", linetype = "solid", size = 1.1 )+
  annotate(geom = "text", x = 51000, y = 'Turkey', 
           label = 'Net\nExporters', color = "#076fa1", size = 6, hjust = 0) +
  annotate(geom = "text", x = -51000, y = 'Australia' , 
           label = 'Net\nImporters', color = "#2fc1d3", size = 6, hjust = 1) +
  theme_minimal() 

```

#### Step 4 - Further customize theme

```{r, message=FALSE, warning=FALSE, echo=TRUE, class.source = 'fold-hide'}

color_palette <- c("Exporter" = "#076fa1", "Importer" = "#2fc1d3")

ggplot(df_1, aes(x = net_exports, y =country, fill = net_export_type)) +
  geom_col() +
  scale_fill_manual(values = color_palette) +
  geom_text(data = df_left, 
            aes(label = country,x = -110, y = country), 
            size = 4, hjust = 1, color = 'gray30') +
  geom_text(data = df_right, 
            aes(label = country, x = 200, y = country),
            size = 4, hjust = 0, color= 'gray30' ) +
  geom_text(data = df_left, 
            aes(label = net_exports, x = net_exports, y =country), 
            position = position_nudge(x = 125), 
            size = 4, hjust = 0, color = 'gray30') +
  geom_text(data = df_right, 
            aes(label = net_exports, x = net_exports, y =country), 
            position = position_nudge(x = -125), 
            size = 4, hjust = 1, color = 'gray30') +
  geom_vline(xintercept = 0, colour = "red", linetype = "solid", size = 1.1 )+
  annotate(geom = "text", x = 51000, y = 'Turkey', 
           label = 'Net\nExporters', color = "#076fa1", size = 6, hjust = 0) +
  annotate(geom = "text", x = -51000, y = 'Australia' , 
           label = 'Net\nImporters', color = "#2fc1d3", size = 6, hjust = 1) +
  theme_minimal()  + 
  theme(
    # remove legend
    legend.position='none', 
    # remove automatic x and y axis titles
    axis.title.x = element_blank(),
    axis.title.y = element_blank(),
    # remove y-axis labels and ticks
    axis.text.y=element_blank(), 
    axis.ticks.y=element_blank(),
    # Remove "minor" gridlines (both on x and y axis)
    panel.grid.minor = element_blank(),
    # Control characterics of "major" x gridline
    panel.grid.major.x = element_line(size = 0.5, linetype = 'solid', colour = "#b0bfc8"),
    # Remove "major" y gridline
    panel.grid.major.y = element_blank()
    )


```

#### Step 5 - Control x axis
* Dublicate x axis to top  
* Control the number of ticks  

```{r, message=FALSE, warning=FALSE, echo=TRUE, class.source = 'fold-hide'}

color_palette <- c("Exporter" = "#076fa1", "Importer" = "#2fc1d3")

ggplot(df_1, aes(x = net_exports, y =country, fill = net_export_type)) +
  geom_col() +
  scale_fill_manual(values = color_palette) +
  geom_text(data = df_left, 
            aes(label = country,x = -110, y = country), 
            size = 4, hjust = 1, color = 'gray30') +
  geom_text(data = df_right, 
            aes(label = country, x = 200, y = country),
            size = 4, hjust = 0, color= 'gray30' ) +
  geom_text(data = df_left, 
            aes(label = net_exports, x = net_exports, y =country), 
            position = position_nudge(x = 125), 
            size = 4, hjust = 0, color = 'gray30') +
  geom_text(data = df_right, 
            aes(label = net_exports, x = net_exports, y =country), 
            position = position_nudge(x = -125), 
            size = 4, hjust = 1, color = 'gray30') +
  geom_vline(xintercept = 0, colour = "red", linetype = "solid", size = 1.1 )+
  annotate(geom = "text", x = 51000, y = 'Turkey', 
           label = 'Net\nExporters', color = "#076fa1", size = 6, hjust = 0) +
  annotate(geom = "text", x = -51000, y = 'Australia' , 
           label = 'Net\nImporters', color = "#2fc1d3", size = 6, hjust = 1) +
  theme_minimal()  + 
  theme(
    legend.position='none', 
    axis.title.x = element_blank(),
    axis.title.y = element_blank(),
    axis.text.y=element_blank(), 
    axis.ticks.y=element_blank(),
    panel.grid.minor = element_blank(),
    panel.grid.major.x = element_line(size = 0.5, linetype = 'solid', colour = "#b0bfc8"),
    panel.grid.major.y = element_blank()
    )+
  # Top Axis
  scale_x_continuous(limits = c(-150000, 175000), 
                     breaks=seq(-150000,175000, 25000), 
                     sec.axis = dup_axis())


```
#### Step 6 - Add titles
* Add title and subtitle  

```{r, message=FALSE, warning=FALSE, echo=TRUE, class.source = 'fold-hide'}

color_palette <- c("Exporter" = "#076fa1", "Importer" = "#2fc1d3")

ggplot(df_1, aes(x = net_exports, y =country, fill = net_export_type)) +
  geom_col() +
  scale_fill_manual(values = color_palette) +
  geom_text(data = df_left, 
            aes(label = country,x = -110, y = country), 
            size = 4, hjust = 1, color = 'gray30') +
  geom_text(data = df_right, 
            aes(label = country, x = 200, y = country),
            size = 4, hjust = 0, color= 'gray30' ) +
  geom_text(data = df_left, 
            aes(label = net_exports, x = net_exports, y =country), 
            position = position_nudge(x = 125), 
            size = 4, hjust = 0, color = 'gray30') +
  geom_text(data = df_right, 
            aes(label = net_exports, x = net_exports, y =country), 
            position = position_nudge(x = -125), 
            size = 4, hjust = 1, color = 'gray30') +
  geom_vline(xintercept = 0, colour = "red", linetype = "solid", size = 1.1 )+
  annotate(geom = "text", x = 51000, y = 'Turkey', 
           label = 'Net\nExporters', color = "#076fa1", size = 6, hjust = 0) +
  annotate(geom = "text", x = -51000, y = 'Australia' , 
           label = 'Net\nImporters', color = "#2fc1d3", size = 6, hjust = 1) +
  theme_minimal()  + 
  theme(
    legend.position='none', 
    axis.title.x = element_blank(),
    axis.title.y = element_blank(),
    axis.text.y=element_blank(), 
    axis.ticks.y=element_blank(),
    panel.grid.minor = element_blank(),
    panel.grid.major.x = element_line(size = 0.5, linetype = 'solid', colour = "#b0bfc8"),
    panel.grid.major.y = element_blank()
    )+
  scale_x_continuous(limits = c(-150000, 175000), 
                     breaks=seq(-150000,175000, 25000), 
                     sec.axis = dup_axis()) +
  # Title and Caption
  labs(title = "Unbalanced diets", 
       subtitle = "Cuisine Net Exports Excluding Fast Food")


```

### Final version
* Adjust chart size from chunk properties  
* Save chart into object "v1" 

```{r, message=FALSE, warning=FALSE, echo=TRUE, class.source = 'fold-hide', fig.width=1920/72, fig.height=1080/72, out.width="100%"}

color_palette <- c("Exporter" = "#076fa1", "Importer" = "#2fc1d3")

v1 <- ggplot(df_1, aes(x = net_exports, y =country, fill = net_export_type)) +
  geom_col() +
  scale_fill_manual(values = color_palette) +
  geom_text(data = df_left, 
            aes(label = country,x = -110, y = country), 
            size = 4, hjust = 1, color = 'gray30') +
  geom_text(data = df_right, 
            aes(label = country, x = 200, y = country),
            size = 4, hjust = 0, color= 'gray30' ) +
  geom_text(data = df_left, 
            aes(label = net_exports, x = net_exports, y =country), 
            position = position_nudge(x = 125), 
            size = 4, hjust = 0, color = 'gray30') +
  geom_text(data = df_right, 
            aes(label = net_exports, x = net_exports, y =country), 
            position = position_nudge(x = -125), 
            size = 4, hjust = 1, color = 'gray30') +
  geom_vline(xintercept = 0, colour = "red", linetype = "solid", size = 1.1 )+
  annotate(geom = "text", x = 51000, y = 'Turkey', 
           label = 'Net\nExporters', color = "#076fa1", size = 6, hjust = 0) +
  annotate(geom = "text", x = -51000, y = 'Australia' , 
           label = 'Net\nImporters', color = "#2fc1d3", size = 6, hjust = 1) +
  theme_minimal()  + 
  theme(
    legend.position='none', 
    axis.title.x = element_blank(),
    axis.title.y = element_blank(),
    axis.text.y=element_blank(), 
    axis.ticks.y=element_blank(),
    panel.grid.minor = element_blank(),
    panel.grid.major.x = element_line(size = 0.5, linetype = 'solid', colour = "#b0bfc8"),
    panel.grid.major.y = element_blank()
    )+
  scale_x_continuous(limits = c(-150000, 175000), 
                     breaks=seq(-150000,175000, 25000), 
                     sec.axis = dup_axis()) +
  # Title and Caption
  labs(title = "Unbalanced diets", 
       subtitle = "Cuisine Net Exports Excluding Fast Food")

v1

```

### Save plot
#### as vector or raster image

```{r, echo=FALSE, eval=FALSE, message=FALSE, warning=FALSE, class.source = 'fold-hide'}

# As vector
ggsave(filename = "assets/world-cuisine-preferences.svg", plot = v1, width=1280/72, height=720/72)

# As raster
ggsave(filename = "assets/world-cuisine-preferences.png", plot = v1, width=40, height=22.5)

```

