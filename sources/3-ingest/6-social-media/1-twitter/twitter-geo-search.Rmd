---
pagetitle: "Kamino"
output: 
  html_document:
    theme: lumen
    css: "../../../z-assemblers/assets/styles/content.css"
    df_print: paged
    mathjax: NULL
    code_folding: show
    include:
      in_header: ["../../../z-assemblers/fragments/google-analytics.html", "../../../z-assemblers/fragments/header.html"]
      after_body: "../../../z-assemblers/fragments/footer.html"
    self_contained: false
    lib_dir: "vendor"
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(message=FALSE, warning=FALSE, echo=FALSE)
options(scipen=999)  # turn-off scientific notation like 1e+48

library(tidyverse)
library(rtweet)
library(ggmap)

library(tidygeocoder)
# register_google(key = gmaps, write = TRUE)
# register_google(key = gmaps)

library(knitcitations)
library(bibtex)

```

<div class="activity">
INGEST  
</div>

# Ingest a social media feed
## Twitter

> The focus now is on citizen activism, where citizens express themselves in a peaceful and nonviolent way....\
--- Promise Mkwananzi\

* Case:  Hashtag activism and pop-Up protests
* Case:  Boda bodas, South Sudan
* Case:  Global Traffic Accidents
* Case:  Roads to the capital, South Sudan


```{r, echo=TRUE, message=FALSE}

# whatever name you assigned to your created app
appname <- ""

## twitter api key
key <- ""

## twitter api secret
secret <- ""

## google maps api
gmaps <- ""

twitter_token <- create_token(
  app = appname,
  consumer_key = key,
  consumer_secret = secret,
  set_renv = TRUE)

# Number of tweets to return
n <- 10000

```


# Case:  Hashtag activism and Pop-Up Protests 
## Rappers and actors push Zimbabwe hashtag viral

Hashtag activism is a term coined by media outlets which refers to the use of Twitter's hashtags for Internet activism. The term can also be used to refer to the act of showing support for a cause through a like, share, etc. on any social media platform, such as Facebook or Twitter.

For example, as reported by the BBC, celebrities like rappers Ice Cube, AKA and Lecrae and actresses Thandie Newton and Pearl Thusi have shown how a grassroots campaign can reach their interest through social media.

But it all raises a question -- does it make a difference?  The issue with hashtag activism is whether or not it is actually making a difference in the world, or if it is just a way for people to feel like they are making a difference.  The answer may lie in social media analysis. Here's a start that you can examine in further detail.

```{r, echo=TRUE, message=FALSE}

keyword <- "ZimbabweanLivesMatter"
file <- paste0("archetypes/search-tweets-", keyword, ".csv")

search <- search_tweets(q=keyword, n=n, include_rts = TRUE, lang = "en", retryonratelimit = TRUE)
search

# write_as_csv(search, file, prepend_ids = TRUE, na = "", fileEncoding = "UTF-8")

```

# Case: Boda Bodas
## Search phrase queries

Boda bodas or motorcycle taxis are a common mode of public transport across South Sudan. For many young people, boda bodas provide critical livelihood opportunities as they are able to generate a daily income for themselves and their families by ferrying passengers on their motorcycles from one town to the other. According to authorities in the state, the increase in road accidents involving boda bodas can be attributed to poor skills on the part of the motorcyclists.

```{r}

## search for a phrase
phrase <- "boda bodas"
phrase_file <- paste0("archetypes/search-tweets-", phrase, ".csv")

phrase_search <- search_tweets(q = phrase, n=n, include_rts=FALSE, lang="en", retryonratelimit = TRUE)
phrase_search

write_as_csv(phrase_search, phrase_file, prepend_ids = TRUE, na = "", fileEncoding = "UTF-8")

```

# Case: Global Traffic Accidents
## Search keywords


```{r}

## search for multiple keywords

keywords_and <- "car AND accident AND death OR fatal"
keywords_and_file <- paste0("archetypes/search-tweets-", keywords_and, ".csv")

search_and <- search_tweets(q = keywords_and, n=n, include_rts=FALSE, lang="en", retryonratelimit = TRUE)
search_and

write_as_csv(search_and, keywords_and_file, prepend_ids = TRUE, na = "", fileEncoding = "UTF-8")

## search for any mention of a list of words

keywords_or <- "car accident AND death OR fatal"
keywords_or_file <- paste0("archetypes/search-tweets-", keywords_or, ".csv")

search_or <- search_tweets(keywords_or, n=n, include_rts=FALSE, lang="en", retryonratelimit = TRUE)
search_or

write_as_csv(search_or, keywords_or_file, prepend_ids = TRUE, na = "", fileEncoding = "UTF-8")

```


## Specify a language

```{r}

## vector of all supported language abbreviations
langs <- c("en", "ar", "bn", "cs", "da", "de", "el", "es", "fa", "fi", "fil", 
  "fr", "he", "hi", "hu", "id", "it", "ja", "ko", "msa", "nl", "no", "pl", 
  "pt", "ro", "ru", "sv", "th", "tr", "uk", "ur", "vi", "zh-cn", "zh-tw")

#keywords_lang <- "nairobi, kenya"
#lang_file <- paste0("../archetypes/search-tweets-", keywords_lang, ".csv")

## search for tweets in english that are not retweets
#search_lang <- search_tweets("rstats", lang = "en", n = n, include_rts=FALSE, retryonratelimit = TRUE)

#write_as_csv(search_lang, lang_file, prepend_ids = TRUE, na = "", fileEncoding = "UTF-8")

```


## Search by geographic location


Get coordinate point and set radius


```{r}

# Example English-speaking countries
# Belize
# Dominica
# Guyana
# Trinidad and Tobago
# Honiara, Solomon Islands
# Lautoka, Fiji

location <- 'Honiara, Solomon Islands'

# Based OpenStreetMap
geo_loc_3 <- geo(location, method = 'osm', full_results = TRUE)
geo_loc_3

# "-17.6043956,177.4530138,10mi"
location_coords <- paste0(geo_loc_3$lat, ",", geo_loc_3$long, ",", '10mi')
print(location_coords)

```

Run geocoded search

```{r}

location_file <- paste0("archetypes/search-tweets-", location, ".csv")

## search for tweets sent from the ...
search_geo <- search_tweets("lang:en", geocode = location_coords, n = n, include_rts=FALSE, retryonratelimit = TRUE )

## create lat/lng variables using all available tweet and profile geo-location data
search_geo <- lat_lng(search_geo)
search_geo

# write_as_csv(search_geo, location_file, prepend_ids = TRUE, na = "", fileEncoding = "UTF-8")

```

## Get trends

```{r}

keyword_trends <- "nairobi"
trends_file <- paste0("archetypes/search-tweets-", keyword_trends, ".csv")

search_trends <- get_trends(keyword_trends)
search_trends

write_as_csv(search_trends, trends_file, prepend_ids = TRUE, na = "", fileEncoding = "UTF-8")

```


## Timeline


```{r}

search_timeline <- get_timeline("cnn", n = n)
ts_plot(search_timeline, "hours")

```


## Network Analysis


```{r}

## get friends of multiple accounts
fds <- get_friends(c("", "", ""))

## frequency count of accounts followed by the users queried above
tbl <- table(fds$user_id)

## subset fds data to only those followed by 3 or more
fds3 <- subset(fds, user_id %in% names(tbl[tbl > 2L]))

## convert fds3 to matrix
mat <- as.matrix(fds3)

## convert to graph object
mat <- igraph::graph_from_edgelist(mat)

## plot network
plot(mat)

```


## Clean Results


```{r}

# corpus_csv <- read.csv(file, header = TRUE, stringsAsFactors = TRUE)

#corpus_csv$text <- gsub("https\\S*", "", corpus_csv$text)
#corpus_csv$text <- gsub("@\\S*", "", corpus_csv$text) 
#corpus_csv$text <- gsub("amp", "", corpus_csv$text) 
#corpus_csv$text <- gsub("[\r\n]", "", corpus_csv$text)
#corpus_csv$text <- gsub("[[:punct:]]", "", corpus_csv$text)
#corpus_csv$text <- gsub("http.*", "", corpus_csv$text)
#corpus_csv$text <- gsub("https.*", "", corpus_csv$text)
#corpus_csv$text <- gsub("&", "&", corpus_csv$text)

# write.csv(save_csv, file , row.names = FALSE)

```


# References
## The citations and data sources used for this case





```{js, message=FALSE, warning=FALSE, echo=FALSE}

// Must be included to position footer
$(function() {
  $('.main-container').after($('.footer'));
})

```


