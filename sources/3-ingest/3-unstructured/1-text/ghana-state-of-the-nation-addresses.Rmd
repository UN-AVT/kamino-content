---
pagetitle: "Kamino"
output: 
  html_document:
    theme: lumen
    css: "../../../z-assemblers/assets/styles/content.css"
    df_print: paged
    mathjax: NULL
    code_folding: show
    include:
      in_header: "../../../z-assemblers/fragments/header.html"
      after_body: "../../../z-assemblers/fragments/footer.html"
    self_contained: false
    lib_dir: "vendor"
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(message=FALSE, warning=FALSE, echo=FALSE)
options(scipen=999)  # turn-off scientific notation like 1e+48

# Clear environment and memory
rm(list = ls(all.names = TRUE)) #will clear all objects includes hidden objects.
gc() #free up memory and report the memory usage.

library(tidyverse)
library(tidytext)
library(readtext)
library(ggiraph)

library(kableExtra)

library(showtext)
## Loading Google fonts (https://fonts.google.com/)
font_add_google("Inconsolata", "inconsolata")
# turn on showtext
showtext_auto()

```


<div class="activity">
INGEST  
</div>

# Ghana's state of the nation addresses
## Ingest unstructured (narrative) text files

```{r, out.width="60%", fig.align="center", fig.cap="Photo by U.S. Army"}

masthead <- "assets/John_Kufuor_080917_A_8525L_0057.jpg"
knitr::include_graphics(masthead, dpi=72)

```

<div class="figure-text">President of Ghana, John Agyekum Kufuor, left, and Mrs. Theresa Kufuor</div>

> Today is National Chocolate Day...\
--- H. E. PRESIDENT J. A. KUFUOR\

***

### Reading a single text file - Unstructured narrative text
#### First method: Entire corpus read to one row

```{r, echo=TRUE, message=FALSE, warning=FALSE,class.source = 'fold-hide'}

file_path <- './archetypes/ghana-state-of-the-nation-addresses/sona_2008.txt'

txt_1 <- readtext(file_path)

df_1 <- as.data.frame(txt_1)

df_1

```


#### Alternative - Entire corpus read to one row


```{r, echo=TRUE, message=FALSE, warning=FALSE,class.source = 'fold-hide'}

txt_2 <- read_file(file_path)

df_2 <- as.data.frame(txt_2)
#df_2

str_trunc(df_2, 1000, "right")


```


#### Alternative - Each line as a row


```{r, echo=TRUE, message=FALSE, warning=FALSE,class.source = 'fold-hide'}

con <- file(file_path, blocking = FALSE)
txt_3 <- readLines(con)
close(con)

df_3 <- as.data.frame(txt_3)
str_trunc(df_3, 100, "right")
#df_3

```


### Reading several text files - Unstructured narrative text
#### First method


```{r, echo=TRUE, message=FALSE, warning=FALSE,class.source = 'fold-hide'}

base_url <- "./archetypes/ghana-state-of-the-nation-addresses/"
txt_files <- list.files(base_url, pattern="^sona_.*\\.txt$", full.names=TRUE, recursive=FALSE)
txt_files

txt_set_1 <- c()
for (f in txt_files) {
  txt_set_1 <- c(txt_set_1, paste(readtext(f)))
}

txt_set_1_df <- as.data.frame(txt_set_1)

str_trunc(txt_set_1_df, 100, "right")


```


#### Alternative


```{r, echo=TRUE, message=FALSE, warning=FALSE,class.source = 'fold-hide'}

txt_set_2 <- c()
for (f in txt_files) {
  txt_set_2 <- c(txt_set_2, paste(read_file(f)))
}

txt_set_2_df <- as.data.frame(txt_set_2)
str_trunc(txt_set_2_df, 100, "right")
```


#### Alternative - Each line as a row


```{r, echo=TRUE, message=FALSE, warning=FALSE,class.source = 'fold-hide'}

txt_set_3 <- c()
for (f in txt_files) {
  txt_set_3 <- c(txt_set_3, paste(read_lines(f)))
}

txt_set_3_df <- as.data.frame(txt_set_3)
txt_set_3_trunc <- str_trunc(txt_set_3_df, 100, "right")
# txt_set_3_trunc <- str_trunc(txt_set_2_df, 100, "left")
# txt_set_3_trunc <- str_trunc(txt_set_2_df, 100, "center")

txt_set_3_trunc
#txt_set_3_df

```


### Processing the result
#### A glimpse at text analytic methods

Once the text files are ingested, wrangler, analytic, and visualization methods can be applied. Here are a few examples of the possibilities:


```{r, echo=TRUE, message=FALSE, warning=FALSE,class.source = 'fold-hide'}

# Tokenize to words
text_df <- txt_set_3_df %>% unnest_tokens(word, txt_set_3)
# text_df

# Remove stop words
data(stop_words)
text_df <- text_df %>% anti_join(stop_words)

# Word count
text_df_word_count <- text_df %>% count(word, sort = TRUE) 
text_df_word_count

# Get top 10
top_words <- text_df_word_count %>% top_n(25)
top_words

```


### View
#### visualize top 25 words


```{r, message=FALSE, warning=FALSE, echo=TRUE, class.source ='fold-hide', fig.width=1920/72, fig.height=1080/72, out.width="100%"}

v1 <- ggplot(data = top_words, aes(reorder(word,n), n)) +
  geom_col(fill = "#006C40") +
  labs(y = NULL) +
  coord_flip()

girafe(ggobj = v1, width_svg = 1280/72, height_svg = 720/72,
       options = list(opts_sizing(rescale = TRUE, width = 1.0))
)

```


### References
#### The citations and data sources used for the cases

To illustrate the methods, this case contains several text files for Ghana's state of the nation addresses. The state of the nation address is an annual address to parliament given by the president. It typically summarizes the government's agenda and the progress made in the past year as seen by the administration in power.
  

<pre>
@misc{ghanaimmigrationservice_state,
  author = {Ghana Immigration Service},
  title = {State of the Nation Address (SONA 2021) â€“ Ghana Immigration Service},
  url = {https://home.gis.gov.gh/2021/03/12/state-of-the-nation-address-sona-2021/},
  urldate = {2021-06-05},
  organization = {State of the Nation Address (SONA 2021)}
}
</pre>


```{r, echo=FALSE, eval=FALSE, message=FALSE, warning=FALSE, class.source='fold-hide'}

# eval = FALSE as default; run manually as chunk

# ENTER METADATA
# Use space to separate keywords or "-" for phrases
methods <- "" # mostly used in wranglers and analytics
keywords <- 'Ghana parliament president'
commands <- 'readtext read_file readLines'
sources <- 'Kaggle'

# CREATE METADATA
source("../../../z-scripts/create_metadata.R", local = knitr::knit_global())

# RUN PRODUCTION OUTPUTS
source("../../../z-scripts/create_production_output.R", local = knitr::knit_global())


```


```{js, message=FALSE, warning=FALSE, echo=FALSE}

// Must be included to position footer
$(function() {
  $('.main-container').after($('.footer'));
})

```

