---
pagetitle: "Migrant Smuggling Route by Price"
output: 
  html_document:
    theme: lumen
    css: "../../../z-assemblers/assets/styles/content.css"
    df_print: paged
    mathjax: NULL
    code_folding: show
    include:
      in_header: ["../../../z-assemblers/fragments/google-analytics.html", "../../../z-assemblers/fragments/header.html"]
      after_body: "../../../z-assemblers/fragments/footer.html"
    self_contained: false
    lib_dir: vendor
---


```{r setup, include=FALSE}

knitr::opts_chunk$set(message=FALSE, warning=FALSE, echo = FALSE)
options(scipen = 999) ## To disable scientific notation

# Clear environment and memory
rm(list = ls(all.names = TRUE)) #will clear all objects includes hidden objects.
gc() #free up memory and report the memory usage.

library(tidyverse)
library(sp)
library(sf)
library(rnaturalearth)
library(rnaturalearthdata)
library(ggrepel)
library(ggiraph)

library(showtext)
## Loading Google fonts (https://fonts.google.com/)
font_add_google("Inconsolata", "inconsolata")
# turn on showtext
showtext_auto()

```

<div class="activity">
MAPS
</div>

# Migrant Smuggling Route by Price
## Route Map

```{r, out.width="60%", fig.align="center", fig.cap="Photo by Sujeeth Potla on Unsplash"}

masthead <- "assets/sujeeth-potla-unsplash.jpg"
knitr::include_graphics(masthead, dpi=72)

```

> Business is booming.\
--- 36-year old male smuggler\

***



### Ingest
#### the routes

```{r, message=FALSE, warning=FALSE, echo=TRUE, class.source = 'fold-hide'}

routes <- read.csv("archetypes/migrant-smuggling-route-by-price/route-paths.csv", header = TRUE, stringsAsFactors = FALSE, as.is=T)
routes

```


### Ingest
#### departure and destination points


```{r, message=FALSE, warning=FALSE, echo=TRUE, class.source = 'fold-hide'}

location_points = read.csv("archetypes/migrant-smuggling-route-by-price/location-points.csv", header = TRUE, stringsAsFactors = FALSE, as.is=T)
location_points

```


### Base map
#### natural earth


```{r, message=FALSE, warning=FALSE, echo=TRUE, class.source='fold-show'}

# PLOT NATURAL EARTH BORDERS
ne_world <- ne_countries(scale = "small", returnclass = "sf")
# removes Antarctica
ne_world <- filter(ne_world, iso_a3 != "ATA")

```


### Projection
#### mercator


```{r, message=FALSE, warning=FALSE, echo=TRUE, class.source='fold-show'}

ne_world <- ne_world %>% st_as_sf() %>% st_set_crs(4326)
ne_world <- st_transform(ne_world, crs = "+proj=merc")

routes_sf <- routes %>% st_as_sf(coords = c("xcoord", "ycoord"), crs = 4326) # %>% st_set_crs("+proj=merc")
routes_sf <- st_transform(routes_sf, crs = "+proj=merc")

location_points_sf <- location_points %>% st_as_sf(coords = c("xcoord", "ycoord"), crs = 4326) # %>% st_set_crs("+proj=merc")
location_points_sf <- st_transform(location_points_sf, crs = "+proj=merc")

routes_sf <- as.data.frame(routes_sf)
location_points_sf <- as.data.frame(location_points_sf)

routes_sf <- routes_sf %>% mutate(xcoord = st_coordinates(geometry)[,1], ycoord = st_coordinates(geometry)[,2])
#routes_sf

location_points_sf <- location_points_sf %>% mutate(xcoord = st_coordinates(geometry)[,1], ycoord = st_coordinates(geometry)[,2])
#location_points_sf

```



### Route map
#### with path (interactive), points, and labels


```{r, message=FALSE, warning=FALSE, echo=TRUE, class.source ='fold-hide', out.width="100%"}

theme_opts <- theme(
      text = element_text(family = "inconsolata"), 
      plot.title = element_text(color = "black", size = 14, face = "bold"),
      plot.subtitle = element_text(color = "black", size = 12),
      plot.caption = element_text(color = "#555555", size = 8),
      plot.background = element_blank(),
      panel.grid = element_blank(),
      panel.grid.major = element_blank(),
      panel.grid.minor = element_blank(),
      panel.background=element_rect(fill="white", colour="white"),
      panel.border = element_rect(color = "black", fill = NA, size = 2),
      axis.text = element_blank(),
      axis.line = element_blank(),
      axis.ticks = element_blank(),
      axis.title = element_blank(),
      legend.position="none"
)

route_palette <- c(
  "middle east-europe" = "#8fc44e",
  "african countries transfer" = "#8181e6",
  "european countries transfer" = "#00ccff",
  "direction to the us and canada" = "#9900cc",
  "asia transfer" = "#669999",
  "africa-asia" = "#F57C00",
  "africa-europe" = "#dd87a9"
)

# the extent of the bounding box in the new projection
b <- st_bbox(ne_world)
# b

v1 <- ggplot(data = ne_world) +
  geom_sf(fill="#ede4be", color="#ffffff", stroke=0.5) +
  geom_path_interactive( data = routes_sf, aes( x=xcoord, y=ycoord, group=factor(id), color=color, size=value,
        tooltip = paste0("From: ", from, "\nTo: ", to, "\nHighest documented value: ", format(value, big.mark=",")), data_id = row.names(routes_sf),
        hover_css = "fill:none;stroke:#000000")) +
  geom_point( data = location_points_sf, aes( x=xcoord, y=ycoord ), size=3, color=ifelse(location_points_sf$type == "destination", 'black', '#999999') ) +
  geom_point( data = location_points_sf, aes( x=xcoord, y=ycoord ), size=1.0, color="white" ) +
  geom_text_repel( data = location_points_sf, aes( x=xcoord, y=ycoord, label = location ), seed = 123, 
                   direction = "both", force = 0.5, force_pull = 0, point.size = 4,
                   min.segment.length = 0, segment.size = 0.5, segment.curvature = -0.1, segment.ncp = 3, segment.angle = 20,
                   size=3, color="black", family="inconsolata" ) +
  scale_color_manual( values = route_palette) +
  scale_size_binned(range = c(0.5, 3)) +
  # limits set to area of interest
  coord_sf(crs = "+proj=merc", xlim = c( b["xmin"]*0.7, b["xmax"]*0.85 ), ylim = c( b["ymin"]*0.3, b["ymax"]*0.6) ) +
  labs(x="",
       y="",
       title = "Migrant Smuggling in the World", 
       subtitle="Main Directions of Migrant Smuggling, Prices of Smugglers in EUR") +
  theme_bw() +
  theme_opts
  
girafe(ggobj = v1, width_svg = 16, height_svg = 7.5,
       options = list(opts_sizing(rescale = TRUE, width = 1.0))
)

```


### References
#### citations for narrative and data sources

* Narrative: IOM, visualization by MINDS/CTK, 2017.
* Data sources: georeferenced from raster image using QGIS


```{r, echo=FALSE, eval=FALSE, message=FALSE, warning=FALSE, class.source='fold-hide'}

# eval = FALSE as default; run manually as chunk
# PUSH TO PRODUCTION
source("../../../z-scripts/create_production_output.R", local = knitr::knit_global())

```


```{js, message=FALSE, warning=FALSE, echo=FALSE}

// Must be included to position footer
$(function() {
  $('.main-container').after($('.footer'));
})

```
