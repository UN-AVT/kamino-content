---
pagetitle: "Kamino"
output: 
  html_document:
    theme: lumen
    css: "../../../z-assemblers/assets/styles/content.css"
    df_print: paged
    mathjax: NULL
    code_folding: show
    include:
      in_header: "../../../z-assemblers/fragments/header.html"
      after_body: "../../../z-assemblers/fragments/footer.html"
    self_contained: false
    lib_dir: "vendor"
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(message=FALSE, warning=FALSE, echo = FALSE)
options(scipen = 999) ## To disable scientific notation

# Clear environment and memory
rm(list = ls(all.names = TRUE)) #will clear all objects includes hidden objects.
gc() #free up memrory and report the memory usage.

library(dplyr)
library(countrycode)
library(ggplot2)
library(sf)
library(rnaturalearth)
library(rnaturalearthdata)
library(ggiraph)

library(showtext)
## Loading Google fonts (https://fonts.google.com/)
font_add_google("Inconsolata", "inconsolata")
# turn on showtext
showtext_auto()

```

<div class="activity">
MAPS  
</div>

# Drone privacy laws
## Choropleth Map

```{r, out.width="60%", fig.align="center", fig.cap="Photo by Sharegrid on Unsplash"}

masthead <- "assets/sharegrid-k-unsplash.jpg"
knitr::include_graphics(masthead, dpi=72)

```

> As with all new inventions, there are upsides and downsides. The commercial drone is no exception.\
  But until robust safeguards have been introduced to protect personal privacy from prying eyes in the skies,\
  the true benefits to society of unmanned aerial vehicles will remain unrealised...\
--- Alex Morritt\

***

### Ingest
#### country, continent, legal status

```{r, message=FALSE, warning=FALSE, echo=TRUE, class.source='fold-hide'}

df <- read.csv("archetypes/drone-privacy-laws/drone-privacy-laws.csv", header = TRUE, stringsAsFactors = FALSE)
df

# unique(df$Drone_Legal_Status_as_of_Oct_2020)

```


### Wrangle
#### enrich with ISO3C

```{r, message=FALSE, warning=FALSE, echo=TRUE, class.source='fold-hide'}

df_wrangle <- df
df_wrangle$ISO3 <- countrycode(df_wrangle$Country_Territory, origin = 'country.name', destination = 'iso3c') 
df_wrangle

```


### World map
#### merge attributes by ISO3C


```{r, message=FALSE, warning=FALSE, echo=TRUE, class.source='fold-show'}

# natural earth base map
ne_world <- ne_countries(scale = "small", returnclass = "sf")
# removes Antarctica
ne_world <- filter(ne_world, iso_a3 != "ATA") 
# combine data with map based on ISO3 codes
ne_world_df <- merge(ne_world, df_wrangle, by.x = "iso_a3", by.y = "ISO3", all = TRUE)

```


### Plot
#### Fill by legal status


```{r, message=FALSE, warning=FALSE, echo=TRUE, class.source='fold-hide', fig.width=1920/72, fig.height=1080/72, out.width="100%"}

# theme parameters
theme_opts <- theme(
  legend.position = "bottom",
  legend.title = element_blank(),
  axis.text = element_blank(),
  axis.line = element_blank(),
  axis.ticks = element_blank(),
  axis.title = element_blank(),
  panel.grid = element_blank(),
  panel.grid.major = element_blank(),
  panel.grid.minor = element_blank(),
  panel.background=element_rect(fill="white", colour="white"),
  panel.border = element_blank(),
  plot.background = element_blank(),
)

# color palette to use
status_palette <- c(
  "Unrestricted" = "#599BA1",
  "No drone-related legislation" = "#CCD2E0",
  "Outright ban" = "#F55165",
  "Visual line of sight required" = "#EEA659",
  "Experimental visual line of sight" = "#485C8E",
  "Effective ban" = "#F98169"
)

v1 <- ggplot(data = ne_world_df) +
  # map feature styling
  geom_sf(aes(fill=Drone_Legal_Status_as_of_Oct_2020), color="#FFFFFF", stroke=0.5) +
  scale_fill_manual(values = status_palette) + 
  coord_sf() +
  theme_bw() +
  labs(x="", # Longitude
       y="", # Latitude
       title = "Choropleth Map", 
       subtitle="Drone Privacy Laws") +
  theme_opts

# v1

girafe(ggobj = v1, width_svg = 1280/72, height_svg = 720/72,
       options = list(opts_sizing(rescale = TRUE, width = 1.0))
)

```


### Plot
#### with annotations


```{r, message=FALSE, warning=FALSE, echo=TRUE, class.source='fold-hide', fig.width=1920/72, fig.height=1080/72, out.width="100%"}



```



```{r, echo=FALSE, eval=FALSE, message=FALSE, warning=FALSE, class.source='fold-show'}

# eval = FALSE as default; run manually as chunk

# full version
ggsave(filename = "outputs/drone-privacy-laws-fs.svg", plot = v2, width=1280/72, height=720/72)

# thumbnail version without annotations
ggsave(filename = "outputs/drone-privacy-laws-sm.svg", plot = v1, width=4, height=2.25)

```


### References
#### citations for narrative and data sources

* Narrative and Data: Visual Capitalist, Mapped: Drone Privacy Laws Around the World, https://www.visualcapitalist.com/mapped-drone-privacy-laws-around-the-world/


```{r, echo=FALSE, eval=FALSE, message=FALSE, warning=FALSE, class.source='fold-hide'}

# eval = FALSE as default; run manually as chunk

# ENTER METADATA
# Use space to separate keywords or "-" for phrases
methods <- "" # mostly used in wranglers and analytics
keywords <- 'drone privacy laws'
commands <- 'countrycode ne_countries geom_sf'
sources <- 'Visual Capitalist'

# CREATE METADATA
source("../../../z-scripts/create_metadata.R", local = knitr::knit_global())

# RUN PRODUCTION OUTPUTS
source("../../../z-scripts/create_production_output.R", local = knitr::knit_global())


```



```{js, message=FALSE, warning=FALSE, echo=FALSE}

// Must be included to position footer
$(function() {
  $('.main-container').after($('.footer'));
})

```



