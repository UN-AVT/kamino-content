---
pagetitle: "Citation Rates for Speeding Stops by Race"
output:
  bookdown::gitbook: default
documentclass: book
date: "`r Sys.Date()`"
---

```{r, include=FALSE}

knitr::opts_chunk$set(message=FALSE, warning=FALSE, echo=FALSE)
options(scipen = 999) # turn-off scientific notation like 1e+48

library(tidyverse)
library(ggiraph)
library(lvplot)
library(showtext)
## Loading Google fonts (https://fonts.google.com/)
font_add_google("Inconsolata", "inconsolata")
# turn on showtext
showtext_auto()

```


# Citation Rates for Speeding Stops by Race
## Boxen Plot

```{r, out.width="60%", fig.align="center", fig.cap="Photo by Denny MÃ¼ller on Freepik"}

masthead <- "assets/denny-muller-unsplash.jpg"
knitr::include_graphics(masthead, dpi=72)

```

***

Boxenplots (or letter-value plots) are an advancement of boxplots, designed to visualize distributions more accurately. Boxenplots start with the median (Q2, 50th percentile) as the centerline. Each successive level outward contains half of the remaining data.


### Ingest data 

```{r, message=FALSE, warning=FALSE, echo=TRUE, class.source='fold-hide'}

url_root <- "https://raw.githubusercontent.com/UN-AVT/kamino-source/main/sources/0-shared/data/"
url_file <- "citation-rates-for-speeding-stops/citation-rates-for-speeding-stops.csv"
url <- paste0(url_root, url_file)

df <- read.csv(url, header = TRUE, stringsAsFactors = FALSE)
df

```


### Wrangle data
#### summarize by state and race


```{r, message=FALSE, warning=FALSE, echo=TRUE, class.source='fold-hide'}

byStateAndRace <- df %>%
  group_by(location, state, driver_race) %>%
  summarize(meanRate = mean(citation_rate_speeding_stops))

byStateAndRace$driver_race <- as.factor(byStateAndRace$driver_race)
byStateAndRace <- na.omit(byStateAndRace)


byStateAndRace



```


### Plot Scatter-Jitter
#### facet by state, shape by race

```{r, message=FALSE, warning=FALSE, echo=TRUE, class.source ='fold-hide'}

theme_opts <- theme(
    text = element_text(family = "inconsolata", size = 12), 
    plot.title = element_text(color = "black", size = 16, face = "bold"),
    plot.subtitle = element_text(color = "black", size = 12),
    plot.caption = element_text(color = "#555555", size = 10),
    panel.border = element_rect(colour = "black", fill=NA, size=1),
    panel.background = element_rect(colour = NA, fill="#F9F9F9", size=1),
    panel.spacing.x = unit(1, "lines"),
    panel.spacing.y = unit(1, "lines"),
    panel.grid.major = element_blank(),
    panel.grid.minor = element_blank(),
    strip.text = element_text(size = 12, face = "bold"),
    strip.background = element_blank(),
    legend.position='none'
)


v1 <- ggplot(byStateAndRace, aes(x = driver_race, y = meanRate)) + 
  geom_lv(aes(fill=..LV..)) + scale_fill_brewer(direction=-1) +
  labs(title =  "Citation rates for speeding stops",
       subtitle = "as reported by counties or districts",
       x = "Race",
       y = "Citation Rate",
       caption = "Source: arXiv:1706.05678") +
  theme_minimal() +
  theme_opts

girafe(ggobj = v1, width_svg = 16, height_svg = 9,
       options = list(opts_sizing(rescale = TRUE, width = 1.0))
)

```


### References
#### citations for narrative and data sources

* Narrative sources:  A large-scale analysis of racial disparities in police stops across the United States, [GO](https://arxiv.org/abs/1706.05678){target="_blank"} 
* Data sources: The Stanford Open Policing Project TidyTuesday, [GO](https://github.com/rfordatascience/tidytuesday/tree/master/data/2019/2019-03-19){target="_blank"}
