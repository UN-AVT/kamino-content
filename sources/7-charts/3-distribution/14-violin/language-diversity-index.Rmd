---
pagetitle: "Language Diversity Index"
output:
  bookdown::gitbook: default
documentclass: book
date: "`r Sys.Date()`"
---

```{r, include=FALSE}

knitr::opts_chunk$set(message=FALSE, warning=FALSE, echo=FALSE)
options(scipen = 999) # turn-off scientific notation like 1e+48

library(countrycode)
library(tidyverse)
library(ggiraph)

library(showtext)
## Loading Google fonts (https://fonts.google.com/)
font_add_google("Inconsolata", "inconsolata")
# turn on showtext
showtext_auto()

```

# Language Diversity Index
## Violin


```{r, out.width = "60%", fig.align = 'center', fig.cap="Photo by Bob Brewer on Unsplash"}

masthead <- "assets/bob-brewer-unsplash.jpg"
knitr::include_graphics(masthead, dpi=72)

```

> Everybody smiles in the same language...\
--- George Carlin\ 

***

### Ingest
#### rank, country, ldi

```{r, message=FALSE, warning=FALSE, echo=TRUE, class.source = 'fold-hide'}

df = read.csv("archetypes/language-diversity-index/country-ldi-2017.csv", header=TRUE, stringsAsFactors=TRUE, encoding="UTF-8")
df

```


### Wrangle
#### enrich with iso3c and region

```{r, message=FALSE, warning=FALSE, echo=TRUE, class.source = 'fold-hide'}

df_wrangle <- df
df_wrangle$ISO3C <- countrycode(df_wrangle$Country, origin = 'country.name', destination = 'iso3c')
df_wrangle$REGION <- countrycode(df_wrangle$ISO3C, origin = 'iso3c', destination = 'region')
df_wrangle <- df_wrangle %>% drop_na(REGION)
df_wrangle

```


### Wrangle
#### calculate min max for labels

```{r, message=FALSE, warning=FALSE, echo=TRUE, class.source = 'fold-hide'}

# Clean column names
# Calculate Max and Min ratio for each Region
regionLDI <- df_wrangle %>%
  group_by(REGION) %>%
  mutate(
    MaxByLDI = max(LDI, na.rm = T),
    MinByLDI = min(LDI, na.rm = T)
  ) %>%
  arrange(REGION)
regionLDI

# Filter the Max and Min value only, below countries will be our labels
country_max_ldi <- filter(regionLDI, MaxByLDI == LDI)
country_min_ldi <- filter(regionLDI, MinByLDI == LDI)
country_min_ldi <- filter(country_min_ldi, ISO3C != "IMN" & ISO3C != "SMR")

```


### Plot
#### with min and max labels


```{r, message=FALSE, warning=FALSE, echo=TRUE, class.source = 'fold-hide', fig.width = 1920/72, fig.height = 1080/72, out.width = "100%"}

theme_opts <- theme(
    text = element_text(family = "inconsolata", size = 16), 
    plot.title = element_text(color = "black", size = 16, face = "bold"),
    plot.subtitle = element_text(color = "black", size = 12),
    plot.caption = element_text(color = "#555555", size = 11),
    axis.title.x = element_blank(),
    # axis.title.y = element_blank(),
    axis.text.x = element_text(angle = 90, vjust = 0.5, hjust=1, face = "bold"),
    panel.border = element_blank(),
    panel.background = element_blank(),
    panel.grid.minor.x = element_blank(),
    panel.grid.major.x = element_blank(),
    panel.grid.minor.y = element_blank(),
    #panel.grid.major.y = element_blank(),
    legend.position='none'
)

region_labels <- c("East Asia &\nPacific",
                   "Europe &\nCentral Asia",
                   "Latin America\n& Caribbean",
                   "Middle East &\nNorth Africa", 
                   "North America", 
                   "South Asia", 
                   "Sub-Saharan Africa",
                   "NA"
                   )

v1 <- ggplot(df_wrangle, aes(x=REGION, y=LDI, fill=REGION, color=REGION)) + # x, y order
  geom_violin(alpha = 0.7) + 
  geom_dotplot(binaxis='y', stackdir='center', dotsize=0.3, fill="black", color="black") +
  geom_text(data = country_max_ldi, aes(label = Country, y = (LDI + 0.05)), vjust = 0.0, hjust = 0.5, color = "black", family = "inconsolata") +
  geom_text(data = country_min_ldi, aes(label = Country, y = (LDI - 0.05)), vjust = 1.0, hjust = 0.5, color = "black", family = "inconsolata") +
  scale_x_discrete(labels = region_labels) +
  labs(title="Language Diversity Index", 
       subtitle= NULL,
       caption= NULL,
       x = NULL,
       y = NULL) +
  theme_bw() +
  theme_opts

girafe(ggobj = v1, width_svg = 1280/72, height_svg = 720/72,
      options = list(opts_sizing(rescale = TRUE, width = 0.8)))

```


```{r, echo=FALSE, eval=FALSE, message=FALSE, warning=FALSE, class.source = 'fold-hide'}

# eval = FALSE as default; set to TRUE for production outputs

# full version
ggsave(filename = "assets/language-diversity-index-fs.svg", plot = v1, width=1280/72, height=720/72)

# thumbnail version without annotations
ggsave(filename = "assets/language-diversity-index-sm.png", plot = v1, width=4, height=2.25)

```


### References
#### citations for narrative and data sources

* Narrative and data sources: TBD
