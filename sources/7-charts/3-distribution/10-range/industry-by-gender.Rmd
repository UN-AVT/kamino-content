---
pagetitle: "Industry by Gender"
output:
  html_document:
    theme: lumen
    css: "../../../z-assemblers/assets/styles/content.css"
    df_print: paged
    mathjax: NULL
    code_folding: show
    include:
      in_header: ["../../../z-assemblers/fragments/google-analytics.html", "../../../z-assemblers/fragments/header.html"]
      after_body: "../../../z-assemblers/fragments/footer.html"
    self_contained: false
    lib_dir: "vendor"
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(message=FALSE, warning=FALSE, echo=FALSE)
options(scipen=999)  # turn-off scientific notation like 1e+48

# Clear environment and memory
rm(list = ls(all.names = TRUE)) #will clear all objects includes hidden objects.
gc() #free up memory and report the memory usage.

library(tidyverse)
library(ggiraph)

library(showtext)
## Loading Google fonts (https://fonts.google.com/)
font_add_google("Inconsolata", "inconsolata")
# turn on showtext
showtext_auto()

```

<div class="activity">
CHARTS  
</div>

# Industry by Gender
## A range plot showing gender employment by industry

```{r, out.width = "60%", fig.align = 'center', fig.cap="Photo by Pop Zebra on Unsplash"}

masthead <- "assets/pop-zebra-unsplash.jpg"
knitr::include_graphics(masthead, dpi=72)

```

> The road to success is always under construction...\
--- Lily Tomlin\


***

### Ingest
#### area, year, trend

```{r, message=FALSE, warning=FALSE, echo=TRUE, class.source = 'fold-hide'}

url_root <- "https://raw.githubusercontent.com/UN-AVT/kamino-source/main/sources/0-shared/data/"
url_file <- "industry-by-gender/industry-by-gender.csv"
url <- paste0(url_root, url_file)

df <- read.csv(url, header = TRUE, stringsAsFactors = TRUE)
df

```


### Wrangle
#### filter for rising and declining


```{r, message=FALSE, warning=FALSE, echo=TRUE, class.source = 'fold-hide'}

df_wrangle <- df %>%
  filter(race_gender!="TOTAL") %>%
  filter(year==2020) %>%
  mutate(gender=case_when(race_gender=="Men" ~ "Men", race_gender=="Women" ~ "Women", TRUE ~ "NA")) %>% 
  filter(gender!="NA") %>%
  drop_na() %>%
  mutate(industry = recode(industry, "Mining, quarrying, and\r\noil and gas extraction" = "Mining, quarrying, and oil and gas extraction")) %>% 
  group_by(gender, industry, year) %>% summarise(employed = sum(employ_n)) %>% 
  group_by(industry, year) %>% mutate(percent = employed / sum(employed)) %>%
  select(-c(employed))
  

df_wrangle <- df_wrangle %>% pivot_wider(names_from = gender, values_from = percent) %>%  
  mutate(diff = Men-Women)

df_wrangle

```


### Plot
#### Do industries employ more men or women?


```{r, message=FALSE, warning=FALSE, echo=TRUE, class.source ='fold-hide'}

theme_opts <- theme(
    text = element_text(family = "inconsolata"), 
    plot.title = element_text(color = "black", size = 14, face = "bold"),
    plot.subtitle = element_text(color = "black", size = 12),
    plot.caption = element_text(color = "#555555", size = 10, hjust = 1.0, vjust = 1.0),
    axis.title.x = element_blank(),
    axis.title.y = element_blank(),
    axis.text.x = element_text(size = 12, hjust = 0.5, vjust = 0.5),
    axis.text.y = element_blank(),
    panel.border = element_blank(),
    panel.background = element_blank(),
    #panel.grid.minor = element_blank(), # remove minor gridlines
    panel.grid.major.x = element_blank(), # remove x (vertical) gridlines
    panel.grid.minor.x = element_blank(), # remove x (vertical) gridlines
    legend.title = element_blank(), # remove legend title
    legend.text = element_text(color = "black", size = 10),
    legend.position='none',
    plot.margin = unit(c(0.25, 0.25, 0.25, 0.25), "in")
)

v1 = ggplot(df_wrangle) + 
  geom_segment(aes(x=Men, y=industry, xend=Women, yend=industry), lineend = "round", linejoin = "round", size=8, color="#E5E5E5") + 
  geom_point(aes(x=Men, y=industry), shape = 21, size = 16, color="#1E88E5", fill = "#FFFFFF", stroke = 1.5) + 
  geom_text(aes(x=Men, y=industry), label = "\u2642", size = 12, color="black", vjust = 0.55) +
  geom_point(aes(x=Women, y=industry), shape = 21, size = 16, color="#FB8C00", fill = "#FFFFFF", stroke = 1.5) + 
  geom_text(aes(x=Women, y=industry), label = "\u2640", size = 12, color="black", vjust = 0.55) +
  scale_x_continuous() +
  scale_y_discrete() +
  labs(title = "Do industries employ more men or women?") +
  theme_minimal() +
  theme_opts +
  xlab(NULL) +
  ylab(NULL)

girafe(ggobj = v1, width_svg = 12, height_svg = 15,
       options = list(opts_sizing(rescale = FALSE, width = 1.0)))

```


### Plot
#### with center labels


```{r, message=FALSE, warning=FALSE, echo=TRUE, class.source ='fold-hide'}

industry_df <- data.frame( industry = unique(df_wrangle$industry))

v2 = ggplot(df_wrangle) + 
  geom_segment(aes(x=Men, y=industry, xend=Women, yend=industry), lineend = "round", linejoin = "round", size=8, color="#E5E5E5") + 
  geom_point(aes(x=Men, y=industry), shape = 21, size = 16, color="#1E88E5", fill = "#FFFFFF", stroke = 1.5) + 
  geom_text(aes(x=Men, y=industry), label = "\u2642", size = 12, color="black", vjust = 0.55) +
  geom_point(aes(x=Women, y=industry), shape = 21, size = 16, color="#FB8C00", fill = "#FFFFFF", stroke = 1.5) + 
  geom_text(aes(x=Women, y=industry), label = "\u2640", size = 12, color="black", vjust = 0.55) +
  geom_text(data = industry_df, aes(x=0.50, y=industry, label = toupper(industry) ), size = 4, color="black", vjust = 0.0, hjust = 0.5, nudge_y = 0.4, family = "inconsolata") +
  scale_x_continuous() +
  scale_y_discrete() +
  labs(title = "Do industries employ more men or women?") +
  theme_minimal() +
  theme_opts +
  xlab(NULL) +
  ylab(NULL)

girafe(ggobj = v2, width_svg = 12, height_svg = 15,
       options = list(opts_sizing(rescale = FALSE, width = 1.0)))

```


### References
#### citations for narrative and data sources

* Inspiration: Rebecca Stevick, [GO](https://github.com/rjstevick/TidyTuesday){target="_blank"}
* Data Source: Bureau of Labor Statistics, [GO](https://www.bls.gov/data/){target="_blank"}


```{r, echo=FALSE, eval=FALSE, message=FALSE, warning=FALSE, class.source='fold-hide'}

# eval = FALSE as default; run manually as chunk
# PUSH TO PRODUCTION
source("../../../z-scripts/create_production_output.R", local = knitr::knit_global())

```


```{js, message=FALSE, warning=FALSE, echo=FALSE}

// Must be included to position footer
$(function() {
  $('.main-container').after($('.footer'));
})

```

