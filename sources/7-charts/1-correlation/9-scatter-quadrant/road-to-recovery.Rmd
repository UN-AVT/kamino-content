---
pagetitle: "Road to Recovery"
output:
  html_document:
    theme: lumen
    css: "../../../z-assemblers/assets/styles/content.css"
    df_print: paged
    mathjax: NULL
    code_folding: show
    include:
      in_header: ["../../../z-assemblers/fragments/google-analytics.html", "../../../z-assemblers/fragments/header.html"]
      after_body: "../../../z-assemblers/fragments/footer.html"
    self_contained: false
    lib_dir: "vendor"
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(message=FALSE, warning=FALSE, echo=FALSE)
options(scipen=999)  # turn-off scientific notation like 1e+48

# Clear environment and memory
rm(list = ls(all.names = TRUE)) #will clear all objects includes hidden objects.
gc() #free up memory and report the memory usage.

library(tidyverse)
library(ggrepel)
library(ggiraph)
library(ggflags)
#remotes::install_github('rensa/ggflags')
library(countrycode)

library(showtext)
## Loading Google fonts (https://fonts.google.com/)
font_add_google("Inconsolata", "inconsolata")
# turn on showtext
showtext_auto()

```

<div class="activity">
WRANGLERS  
</div>

# Road to Recovery
## Scatter Quadrant


```{r, out.width = "60%", fig.align = 'center', fig.cap="Photo by Matt Collamer on Unsplash"}

masthead <- "assets/julian-wan-unsplash.jpg"
knitr::include_graphics(masthead, dpi=72)

```

> Everything will be okay in the end. If it’s not okay, it’s not the end...\
--- John Lennon\

***

### Ingest the source

```{r, message=FALSE, warning=FALSE, echo=TRUE, class.source = 'fold-hide'}

df = read.csv("archetypes/road-to-recovery/road-to-recovery.csv", header = TRUE, stringsAsFactors = FALSE)
df

```


### Wrangle
#### select, clean, and cast data types


```{r, message=FALSE, warning=FALSE, echo=TRUE, class.source = 'fold-hide'}

df <- df[-12,]

colnames(df)[1] <- "country" # Changing Column Name


df$Mobility.Rate<-as.numeric(gsub("\\%","",df$Mobility.Rate)) # Removin percent sign
df$Recovery.Rate<-as.numeric(gsub("\\%","",df$Recovery.Rate))
df$Total.Cases<-as.numeric(gsub("\\,","",df$Total.Cases))
df$Total.Recovered<-as.numeric(gsub("\\,","",df$Total.Recovered))

library(countrycode)
df$iso <- tolower(countrycode(sourcevar = df[, "country"],
                            origin = "country.name",
                            destination = "iso2c"))

df

```


### Scatter Quadrant Plot

```{r, warning=FALSE, echo=TRUE, class.source = 'fold-hide',out.width = "100%"}

theme_opts <- theme(
    text = element_text(family = "inconsolata"), 
    plot.title = element_text(color = "black", size = 20, face = "bold"),
    plot.subtitle = element_text(color = "black", size = 15),
    plot.caption = element_text(color = "#555555", size = 8),
    axis.text = element_text(size=10),
    panel.border = element_blank(),
    panel.background = element_blank(),
    legend.title = element_text(color = "black", size = 8, face = "bold"), 
    legend.text = element_text(color = "black", size = 8),
    legend.position = "none"
)


v1 <- ggplot(df, aes(x=Recovery.Rate, y=Mobility.Rate, country = iso, label=country)) +
  annotate("rect", xmin = 0, xmax = 50, ymin = -50, ymax = 20, fill= "white", color = "white")  + 
  annotate("rect", xmin = 50, xmax = 100, ymin = -50, ymax = 20, fill= "#c3e8ee", color = "white") + 
  annotate("rect", xmin = 0, xmax = 50, ymin = -120, ymax = -50, fill= "#f3d4d9", color = "white") + 
  annotate("rect", xmin = 50, xmax = 100, ymin = -120, ymax = -50, fill= "white", color = "white")+
  annotate("text", x = 60, y=15, label= "High Mobility, High recovery\nLifted Restrictions &\nPeople going back to work")+
  annotate("text", x = 10, y=-60, label= "Low Mobility, Low recovery\nRemaining Indoors") +
  annotate("text", x = 10, y=15, label= "High Mobility, Low recovery\nAllowing activity\nPossible surge in Future") +
  annotate("text", x = 60, y=-115, label= "Low Mobility, High recovery\nPlaying it Safe") +
  geom_point() +
  geom_flag()+
  geom_text_repel() +
  scale_y_continuous(breaks=c(20, 0, -40, -80, -120),
                  labels=c('20%', '0', '-40%', '-80%', '-12%')) +
  scale_x_continuous(breaks=c(0, 25, 50, 75, 100),
                  labels=c('0', '25%', '50%', '75%', '100%'))+
      labs(y="Mobility Rate",
           x = "Recovery Rate",
       title = "The Road to Recovery",
       subtitle = "Which Economies are Reopening? \nThe higher the mobility rate, the more activity this signifies")+
  theme_opts


girafe(ggobj = v1, width_svg = 16, height_svg = 15,
       options = list(opts_sizing(rescale = TRUE, width = 0.8)))


```



```{r, echo=FALSE, eval=FALSE, message=FALSE, warning=FALSE, class.source = 'fold-hide'}

# full version
ggsave(filename = "assets/road-to-recovery-fs.svg", plot = v1, width=16, height=15)

# without annotations
# ggsave(filename = "assets/worlds-most-generous-sm.svg", plot = v1, width=4, height=2.25)

```


### References
#### Citations and data sources

* Inspiration and data: The Visual Capitalist, [GO](https://www.visualcapitalist.com/the-road-to-recovery-which-economies-are-reopening-covid-19/){target="_blank"}


```{r, echo=FALSE, eval=FALSE, message=FALSE, warning=FALSE, class.source='fold-hide'}

# eval = FALSE as default; run manually as chunk
# PUSH TO PRODUCTION
source("../../../z-scripts/create_production_output.R", local = knitr::knit_global())

```


```{js, message=FALSE, warning=FALSE, echo=FALSE}

// Must be included to position footer
$(function() {
  $('.main-container').after($('.footer'));
})

```

