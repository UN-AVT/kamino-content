---
pagetitle: "Job Automation"
output:
  html_document:
    theme: lumen
    css: "../../../z-assemblers/assets/styles/content.css"
    df_print: paged
    mathjax: NULL
    code_folding: show
    include:
      in_header: ["../../../z-assemblers/fragments/google-analytics.html", "../../../z-assemblers/fragments/header.html"]
      after_body: "../../../z-assemblers/fragments/footer.html"
    self_contained: false
    lib_dir: "vendor"
---

```{r setup, include=FALSE}

knitr::opts_chunk$set(message=FALSE, warning=FALSE, echo=FALSE)
options(scipen=999)  # turn-off scientific notation like 1e+48

# Clear environment and memory
rm(list = ls(all.names = TRUE)) #will clear all objects includes hidden objects.
gc() #free up memory and report the memory usage.

library(tidyverse)
library(ggrepel)
library(ggiraph)

library(showtext)
## Loading Google fonts (https://fonts.google.com/)
font_add_google("Inconsolata", "inconsolata")
# turn on showtext
showtext_auto()

```

<div class="activity">
CHARTS  
</div>

# Job Automation
## Bubble Chart

```{r, out.width="60%", fig.align="center", fig.cap="Photo by Taiki Ishikawa on Unsplash"}

masthead <- "assets/taiki-ishikawa-unsplash.jpg"
knitr::include_graphics(masthead, dpi=72)

```

> Robots will harvest, cook, and serve our food.\
  They will work in our factories, drive our cars, and walk our dogs.\
  Like it or not, the age of work is coming to an end...\
--- Gray Scott\

***

### Ingest data
#### country, city, line, start_year, end_year, time_comp, length, cost, etc.

```{r,  message=FALSE, warning=FALSE, echo=TRUE, class.source = 'fold-hide'}

# file path parameter
url_root <- "https://raw.githubusercontent.com/UN-AVT/kamino-source/main/sources/0-shared/data/"
url_file <- "job-automation/job-automation.csv"
url <- paste0(url_root, url_file)

df <- read.csv(url, header = TRUE, stringsAsFactors = FALSE)

df


```

### Wrangle data
#### select all the visual variables, order by number employed (size variable)

```{r,  message=FALSE, warning=FALSE, echo=TRUE, class.source = 'fold-hide'}

df_wrangle <- df %>% select(prob, Average_annual_wage, education, short_occupation, numbEmployed)

df_wrangle <- df_wrangle[order(df_wrangle$numbEmployed, decreasing = TRUE),]

df_wrangle

```

### Plot
#### x, y, size, color

* prob
* Average_annual_wage
* education
* short_occupation
* numbEmployed

```{r, message=FALSE, warning=FALSE, echo=TRUE, class.source = 'fold-hide', out.width = "100%"}

theme_opts <- theme(
    text = element_text(family = "inconsolata"), 
    plot.title = element_text(color = "black", size = 14, face = "bold"),
    plot.subtitle = element_text(color = "black", size = 12),
    plot.caption = element_text(color = "#555555", size = 8),
    # axis.title.x = element_blank(),
    # axis.title.y = element_blank(),
    # axis.text.x = element_text(vjust = 12),
    panel.border = element_blank(),
    panel.background = element_blank(),
    panel.grid.minor = element_blank(), # remove minor gridlines
    # panel.grid.major.x = element_blank(), # remove x (vertical) gridlines
    # panel.grid.major.y = element_blank(), # remove y (horizontal) gridlines
    legend.title = element_blank(), # remove legend title
    # legend.text = element_text(color = "black", size = 8),
    legend.position='none'
)

education_palette <- c(
  "High school diploma or equivalent" = "#d49a5e",
  "Bachelor's degree" = "#61a46c",
  "Postsecondary nondegree award" = "#f1d517",
  "Associate's degree" = "#61a46c",
  "No formal educational credential" = "#c6553c",
  "Doctoral or professional degree" = "#5080a2"
)

v1 <- ggplot(data = df_wrangle, aes(x = prob, y = Average_annual_wage)) +
    geom_point(aes(size = numbEmployed, fill = education), 
                           shape = 21, color = "#FFFFFF", stroke = 1.0, alpha = 0.7) +
    scale_x_continuous() +
    scale_y_continuous(breaks = seq(0, 300000, 25000), labels = scales::dollar) +
    scale_fill_manual(values = education_palette) +
    # scale_size_area(max_size = 10) +
    scale_size(range = c(2, 15)) +
    labs(title = "Job Automation",
        subtitle = "color by education level, sized by number employed",
        x = 'less likely <- probability of automation -> most likely',
        y = 'average annual wage',
        caption = "Source:Transit Costs Project")+
    theme_minimal() +
    theme_opts


girafe(ggobj = v1, width_svg = 16, height_svg = 12,
       options = list(opts_sizing(rescale = TRUE, width = 0.8)))

```


### Wrangle
#### create a label subset


```{r,  message=FALSE, warning=FALSE, echo=TRUE, class.source = 'fold-hide'}

label_list <- c(
  "Orthodonists",
  "Dentists",
  "Airline Pilots, Copilots and Flight Engineers",
  "Podiatrists",
  "Preschool Teachers",
  "Recreation Workers",
  "Animal Control Workers",
  "Ambulance Drivers and Attendants",
  "Radiation Therapists",
  "Judges",
  "Home Health Aides",
  "Shoe and Leather Workers and Repairers",
  "Financial Advisors",
  "Geoscientists",
  "Cooks, Fast Food",
  "Food Preparation & Serving Workers",
  "Nuclear Technicians",
  "Benefits Managers",
  "Insurance Underwriters",
  "Sewers, Hand"
)

df_labels <- filter(df_wrangle, short_occupation %in% label_list)
df_labels

```


### Plot
#### adding labels


```{r, message=FALSE, warning=FALSE, echo=TRUE, class.source = 'fold-hide', out.width = "100%"}

v2 <- v1 +
  geom_text_repel(data=df_labels, aes(label = short_occupation), box.padding = 0.75, direction = "y", min.segment.length = 0.0, nudge_y = 0.75, point.padding = 0.5, family = "inconsolata")

girafe(ggobj = v2, width_svg = 16, height_svg = 12,
       options = list(opts_sizing(rescale = TRUE, width = 0.8)))

```

### References
#### citations for narrative and data sources

* Narrative sources: Bloomberg, [GO](https://www.bloomberg.com/graphics/2017-jobs-automation-risk/){target="_blank"}
* Data sources: Frey & Osborne, Bureau of Labor Statistics


```{r, echo=FALSE, eval=FALSE, message=FALSE, warning=FALSE, class.source='fold-hide'}

# eval = FALSE as default; run manually as chunk
# PUSH TO PRODUCTION
source("../../../z-scripts/create_production_output.R", local = knitr::knit_global())

```


```{js, message=FALSE, warning=FALSE, echo=FALSE}

// Must be included to position footer
$(function() {
  $('.main-container').after($('.footer'));
})

```
