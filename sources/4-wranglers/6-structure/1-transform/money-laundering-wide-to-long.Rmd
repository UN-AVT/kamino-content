---
pagetitle: "Money Laundering"
output:
  bookdown::gitbook: default
documentclass: book
date: "`r Sys.Date()`"
---


```{r, include=FALSE}

knitr::opts_chunk$set(message=FALSE, warning=FALSE, echo=FALSE)
options(scipen=999)  # turn-off scientific notation like 1e+48

library(tidyverse)
library(purrr)
library(tidyr)
library(readxl)
library(kableExtra)
library(knitcitations)
library(bibtex)

library(showtext)
## Loading Google fonts (https://fonts.google.com/)
font_add_google("Inconsolata", "inconsolata")
# turn on showtext
showtext_auto()

```

WRANGLERS  

# Money Laundering
## Transform: Wide to Long

```{r, out.width="60%", fig.align="center", fig.cap="Photo by Sasun Bughdaryan on Unsplash"}

masthead <- "assets/sasun-bughdaryanunsplash.jpg"
knitr::include_graphics(masthead, dpi=72)

```


> The focus now is on citizen activism, where citizens express themselves in a peaceful and nonviolent way....\
--- Promise Mkwananzi\

***

Wide and Long Data are two terms used to represent different presentations of tabular data. In the wide format, each response variable is in a separate column. Data stored in long form has a single column for each variable in the system.

Whether the wide or long format is appropriate is dependent on the model or analytics you're trying to process. The long format seems to be the popular choice in most cases because you want each unit of observation to be its own row. However, in most survey research or social sciences, the wide format seems to be a popular choice. Thus, it is necessary for us to learn how to transform between the two tabular formats.

### Load data
Here we have a wide data format.


```{r load raw data,  message=FALSE, warning=FALSE, echo=TRUE, class.source = 'fold-hide'}

df <- read_excel('./archetypes/money_laundering.xlsx')

```


By looking at the dataframe we can see that there are two header rows. The first rows encompasses the data across the year. The second header row encompasses the three category: Clear, Count, Rate.

Normally we can jump straing to pivotting the data frame but it might be imperative to convert it to a 1-header data frame first. 


```{r, message=FALSE, echo=FALSE}

# Start by renaming your columns to include both the year and variable
# The use of '-' to separate the parts is for convenience in the regex below
names(df)[4:ncol(df)] <- paste(df[1, 4:ncol(df)],
                                 gsub("\\..*","",names(df)[4:ncol(df)]),
                                 sep = "-")

names(df)[1:3] <- df[1, 1:3]

df <- df[2:nrow(df), ] # We will remove the 2nd row now


df
```

Now that we've transformed the headers, we can now pivot it using dplyr. 

```{r , message=FALSE, warning=FALSE, echo=TRUE, class.source = 'fold-show'} 

df1 <- df %>%
  gather(key, value, -c(Region, `Sub-region`, Country)) %>%
  separate(key, into = c("measure", "year")) %>%
  spread(key = measure, value)

df1

```


Notice the columns containg the years have been reduced to three columns: Clear, Count and Rate. We can even go a step further to make the data longer. We'll try another method from the tidyr library.

```{r , message=FALSE, warning=FALSE, echo=TRUE, class.source = 'fold-show'} 

df_longer <- gather(data= df1,
      key =   Category,
      value =  Value,
      `Clear`:`Rate`, # Names of source columns that contain values
      factor_key=FALSE) # Treat the new key column as a factor (instead of character vector)

df_longer <- na.omit(df_longer)

df_longer

```

### References
#### citations for narrative and data sources

* Narrative sources and data: United Nations Office on Drugs and Crime, [GO](https://dataunodc.un.org/){target="_blank"}
