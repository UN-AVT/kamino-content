---
pagetitle: "World Cup Matches"
output:
  bookdown::gitbook: default
documentclass: book
date: "`r Sys.Date()`"
---


```{r, include=FALSE}

knitr::opts_chunk$set(message=FALSE, warning=FALSE, echo=FALSE)
options(scipen=999)  # turn-off scientific notation like 1e+48

library(tidyverse)
library(ggiraph)
library(sf)
library(rnaturalearth)
library(scales)
library(ggrepel)

library(showtext)
## Loading Google fonts (https://fonts.google.com/)
font_add_google("Inconsolata", "inconsolata")
# turn on showtext
showtext_auto()
```

WRANGLERS  

# World Cup Matches
## Preserve Images

```{r, out.width="60%", fig.align="center", fig.cap="Photo by Fauzan Saari on Unsplash"}

masthead <- "assets/fauzan-saari-AmhdN68wjPc-unsplash.jpg"
knitr::include_graphics(masthead, dpi=72)

```

<div class="figure-text">World Cup Trophy</div>


> The only way to win is as a team...\
--- Pele\


***

### Load the data

```{r load-data, message=FALSE, warning=FALSE, echo=TRUE, class.source = 'fold-hide'}

url_root <- "https://raw.githubusercontent.com/UN-AVT/kamino-source/main/sources/0-shared/data/"
url_file <- "world-cup-matches/world-cup-matches.csv"
url <- paste0(url_root, url_file)
df_world_cup <- read_csv(url)
df_world_cup

```

### Wrangle
#### Remove Missing Value
```{r method: clean, message=FALSE, echo=TRUE,warning=FALSE}

#df_world_cup1 <- na.omit(df_world_cup)

df_world_cup1 <- df_world_cup[!is.na(df_world_cup$Year),]

#df_world_cup1A <- df_world_cup1[!is.na(df_world_cup1$`Home Team Name`),]

df_world_cup1

```

#### Replace Values (Replace Home Team Names _Germany FR_ to _Germany_)

```{r method: find, message=FALSE, echo=TRUE,warning=FALSE}
df_world_cup1 %>% filter(str_detect(`Home Team Name`, "^Germany"))

```

```{r method: replace, message=FALSE, echo=TRUE,warning=FALSE}
df_world_cup2 <- df_world_cup1


df_world_cup2$`Home Team Name` <- replace(df_world_cup2$`Home Team Name`, df_world_cup2$`Home Team Name`=="Germany FR","Germany" )

df_world_cup2

```

#### Select only meaningful columns
```{r method: select, message=FALSE, echo=TRUE,warning=FALSE}

df_world_cup3 <- df_world_cup2

#df_world_cup3 <- df_world_cup3[,c(1,5:9,14)]

df_world_cup3 <- df_world_cup3 %>% select(Year,`Home Team Name`, `Home Team Goals`,`Away Team Goals`, `Away Team Name`, `Referee`)

df_world_cup3

```

#### Rename meaningful columns
```{r method: rename, message=FALSE, echo=TRUE,warning=FALSE}

df_world_cup4 <- df_world_cup3

df_world_cup4 <- df_world_cup4 %>% rename(Home_Team='Home Team Name', Away_Team='Away Team Name', Home_Team_Goals='Home Team Goals', Away_Team_Goals='Away Team Goals')

#head(df_world_cup4)
df_world_cup4


```

### Reduce data
#### Filter data - Home_team is Brazil & Away_Team is Germany

```{r method: filter, message=FALSE, echo=TRUE,warning=FALSE}

df_world_cup5 <- df_world_cup4

df_world_cup5 <- df_world_cup5 %>% filter((Home_Team=="Brazil") & (Away_Team=="Germany"))

df_world_cup5
```


#### Filter data - It is OK for Home Teams to Lose! :-()
#### Filter all countries that have lost at home

```{r method: an, message=FALSE, echo=TRUE,warning=FALSE}
df_world_cup6 <- df_world_cup4

df_world_cup6 <- df_world_cup6 %>% filter(Home_Team_Goals<Away_Team_Goals)

df_world_cup6 
#df_world_cup6 %>% filter(str_detect(`Home_Team`, "^Germany"))
#df_world_cup6 %>% filter(str_detect(`Home_Team`, "^Brazil"))
```

### Extend data
#### Group data - how many goals taken by home team 


```{r method: cl, message=FALSE, echo=TRUE,warning=FALSE}

df_world_cup7 <- df_world_cup6

df_world_cup7 <- df_world_cup7 %>% group_by(Home_Team) %>% 
                                   summarise(Total_Goals_Taken = sum(Away_Team_Goals), Number_Games = n())

df_world_cup7
```


### Sort - Not Sore Losers!
#### Do you know why these are the countries that have lost more?

```{r method: clan, message=FALSE, echo=TRUE,warning=FALSE}
df_world_cup8 <- df_world_cup7

df_world_cup8 <- df_world_cup8 %>% arrange(desc(Total_Goals_Taken))
#df_world_cup8 <- df_world_cup8 %>% arrange(desc(Number_Games))

df_world_cup8

```

###  Plot

```{r load rw data,  message=FALSE, warning=FALSE, echo=TRUE, class.source = 'fold-hide', fig.width= 1920/72, fig.height = 1080/72, out.width = "100%"}

# For the first 20 countries
df_world_cup9 <- df_world_cup8[1:20,]

v1 <- ggplot(df_world_cup9, aes(x=reorder(Home_Team, Total_Goals_Taken), y=Total_Goals_Taken))+
  geom_bar(stat="identity", fill="steelblue") +
  coord_flip() + 
  scale_y_continuous(labels = comma) +
  labs(y="Number of Goals Taken", x="Home Team")+ 
  ggtitle("Total of Goals Taken by Home Teams (1930-2014)")

girafe(ggobj = v1, width_svg = 1280/72, height_svg = 720/72, options =
list(opts_sizing(rescale = TRUE, width = 1.0)))
```

###  Preserve

We will now save the plot by using the R function <kbd>ggsave()</kbd>

```{r , message=FALSE, echo=TRUE,warning=FALSE}
#Save the last file created
ggsave(file="output/world-cup-matches.svg", plot=v1, width=10, height=8)

```


# References
## The citations and data sources used for this case can be found be found on the Fifa World Cup data on <a href="https://www.kaggle.com/abecklas/fifa-world-cup" target="_blank"> Kaggle. </a>

<pre>
@misc{kaggle_2019_fifa,
  author = {Kaggle},
  title = {FIFA World Cup},
  url = {https://www.kaggle.com/abecklas/fifa-world-cup},
  urldate = {2021-06-08},
  year = {2019},
  organization = {kaggle.com}
}
</pre>

