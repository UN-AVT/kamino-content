---
pagetitle: "Bridges to Prosperity"
output:
  bookdown::gitbook: default
documentclass: book
date: "`r Sys.Date()`"
---

```{r, include=FALSE}

knitr::opts_chunk$set(message=FALSE, warning=FALSE, echo=FALSE)
options(scipen=999)  # turn-off scientific notation like 1e+48

library(tidyverse)
library(sf)
library(rnaturalearth)
library(rnaturalearthdata)
library(rgeos)
library(ggspatial)
library(ggiraph)

library(showtext)
## Loading Google fonts (https://fonts.google.com/)
font_add_google("Inconsolata", "inconsolata")
# turn on showtext
showtext_auto()


```

WRANGLERS  

# Bridges to Prosperity
## Store  

```{r, out.width="60%", fig.align="center", fig.cap="Photo by Bridges to Prosperity"}

masthead <- "assets/bridge.jpg"
knitr::include_graphics(masthead, dpi=72)

```

<div class="figure-text">Bridges to Prosperity</div>

> We build too many walls and not enough bridges...\
--- Isaac Newton\


***

### Load the data


```{r load raw data,  message=FALSE, warning=FALSE, echo=TRUE, class.source = 'fold-hide'}

url_root <- "https://raw.githubusercontent.com/UN-AVT/kamino-source/main/sources/0-shared/data/"
url_file <- "bridges-to-prosperity/bridges-to-prosperity.csv"
url <- paste0(url_root, url_file)
df <- read.csv(url, header = TRUE, fileEncoding="UTF-8-BOM")
#added fileEncoding to remove any BOM in the columns names if present in the file (common for files generated from Microsoft applications: Excel, SQL server)

df
```

### Applying __Wranglers Tasks__ to change this data set:

### Evaluate - Clean
Remove all records where __individuals_directly_served__ is missing.

```{r method: clean, message=FALSE, echo=TRUE,warning=FALSE}

df_1 <- df
  
df_1 <- df[!is.na(df$individuals_directly_served), ]    
 
df_1
```


### Prepare - Column
Convert all column names to __uppercase__

```{r method: column uppercase, message=FALSE, echo=TRUE,warning=FALSE}
df_2 <- df_1
names(df_2) <- toupper(names(df_2))

df_2
```

Remove columns that are not relevant

```{r method: remove column, message=FALSE, echo=TRUE,warning=FALSE}
df_3 <- df_2[,c(1,4,6:8,11)]

df_3
```

### Reduce - Filter
Filter only records from __Bolivia__, __Uganda__ and __Rwanda__ in the  __COUNTRY__ column and the __STAGE__ is __Complete__

```{r method: filter, message=FALSE, echo=TRUE,warning=FALSE}

df_4 <- df_3 %>% filter((COUNTRY=="Bolivia") | (COUNTRY=="Uganda") | (COUNTRY=="Rwanda"))

df_4 <- df_4 %>% filter(STAGE=="Complete")

df_4

```


### Extend - Group
Let's find out how many individuals the bridges have served in each country per year

```{r method: group, message=FALSE, echo=TRUE,warning=FALSE}
df_5 <- df_4 %>% group_by(`COUNTRY`, `B2P_FISCAL_YEAR`) %>% summarise(TOTAL_PEOPLE_SERVED=sum(`INDIVIDUALS_DIRECTLY_SERVED`))


df_5
```


### Write to a CSV file
Let's say this final data is enough for us to do further analysis and plot a graph. For the moment, let's save all the changes made to the original data file into a new csv file by using <kbd>write.csv</kbd> 


```{r method: store into a csv file, message=FALSE, warning=FALSE, echo=TRUE, class.source = 'fold-show'}
#write the amended data set into a .csv file

write.csv(df_5, './output/bridges_to_prosperity_summary_output.csv')


```

### Map the data
Let's look at the bridges in Bolivia as an example

```{r draw-plot, message=FALSE, warning=FALSE, echo=TRUE, class.source = 'fold-hide', out.width = "100%"}

# Map and bridges datasets
world <- ne_countries(scale = "medium", returnclass = "sf")
bridges <- st_as_sf(df, coords = c("gps_longitude", "gps_latitude"), crs = 4326, agr = "constant")

# Plot and theme the map
v1 <- ggplot(data = world) +
    geom_sf(color = "gray91", fill = "palegreen", alpha = 0.5) +
    xlab("Longitude") + ylab("Latitude") +
    ggtitle("Bridges in Bolivia") +
    geom_sf(data = bridges, size = 2, shape = 23, fill = "peachpuff4") +
    annotation_north_arrow(location = "bl", which_north = "true", 
        pad_x = unit(0.2, "in"), pad_y = unit(0.2, "in"),
        style = north_arrow_fancy_orienteering) +
    annotate(geom = "text", x = -63, y = -15, label = "Bolivia", color = "grey22", size = 6) +
    coord_sf(xlim = c(-75, -55), ylim = c(-25, -7))


girafe(ggobj = v1, width_svg = 16, height_svg = 9, options =
list(opts_sizing(rescale = TRUE, width = 0.8)))

```

### References
#### citations for narrative and data sources

* Narrative and data sources: bridges built in remote areas in developing countries, [GO](https://www.bridgestoprosperity.org/who-we-are/team/){target="_blank"}


<pre>
@misc{bridgetoprosperity_2018_bridges,
  author = {Bridge to Prosperity},
  title = {Bridges to Prosperity: The global leader in rural infrastructure development},
  url = {https://www.bridgestoprosperity.org/},
  urldate = {2021-04-13},
  year = {2018},
  organization = {Bridges to Prosperity}
}
</pre>

